const e=Symbol("Extensible"),t=Symbol("CacheIdentityKey");function n(e,t){const{implementation:n}=e;if("function"==typeof e)return e;if("function"==typeof n)return n;throw new Error(`No implementation found in plugin definition for member ${t}.`)}function r(e=(()=>{}),t,r){return(...o)=>t.reduce(((t,c)=>()=>{const s=n(c,e.name);return"object"==typeof e?s("function"==typeof t?t():t,r):s(o,t.bind(r),r)}),e)()}const o=["member-function","member-property","static-member","function","class"],c=["function","class"];const s=e=>Array.isArray(e)?e:[e],i=e=>e.sort((({position:e=100},{position:t=100})=>e-t)),u=e=>{const t=e.reduce(((e,t)=>(Object.entries(t).forEach((([t,n])=>{e[t]||(e[t]={}),Object.entries(n).forEach((([n,r])=>{!function(e,t){if(!o.includes(e))throw Error(`Unexpected handler type '${e}' for namespace '${t}', expected one of [${o.join(", ")}]`)}(n,t),c.includes(n)?((e,t,n,r)=>{e[t][n]||(e[t][n]=[]),s(r).forEach((r=>{e[t][n].push(r)}))})(e,t,n,r):((e,t,n,r)=>{e[t][n]||(e[t][n]={}),Object.entries(r).forEach((([r,o])=>{e[t][n][r]||(e[t][n][r]=[]),s(o).forEach((o=>{e[t][n][r].push(o)}))}))})(e,t,n,r)}))})),e)),{});return(e=>{for(const t in e)for(const n in e[t])if(c.includes(n))e[t][n]=i(e[t][n]);else for(const r in e[t][n])e[t][n][r]=i(e[t][n][r])})(t),t};var l=new class{constructor(){this.plugins=[]}setPlugins(e){this.plugins=u(e),(function(){try{if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;if("undefined"!=typeof ServiceWorkerGlobalScope)return ServiceWorkerGlobalScope}catch{}return{}}()).plugins=this.plugins}},a=(e,t,n)=>e.reduce(((e,r)=>{const o=l.plugins&&l.plugins[r]&&l.plugins[r][t];if(n){const{value:t}=Object.getOwnPropertyDescriptor(o||{},n)||{};if(t)return e.concat(t)}else if(o)return e.concat(o);return e}),[]);function f(e){return(t,n,o)=>{const c=a(e,"function");return c.length?r(t,c,n)(...o):t.apply(n,o)}}function p(e,t){return function(e){const t=e[e.length-1];return l.plugins[t]&&l.plugins[t].class||[]}(t).reduce(((t,r)=>{const o=n(r,e.name)(t);if(Object.prototype.isPrototypeOf.call(t,o))throw new Error("Subclassing via `class` API is not allowed.\nConsider using other approach for this, e.g. plugins for members.");return o}),e)}function d(e){return e.prototype.__namespaces__}function g(e){return(t,r,o)=>{const c=p(class extends t{constructor(...e){return function(e,t){const r=d(Object.getPrototypeOf(e).constructor);return a(r,"member-property").forEach((t=>Object.entries(t).forEach((([t,r])=>{const o=e[t]||(()=>{}),c=r.reduce(((t,r)=>n(r,o.name)(t,e)),o);e[t]=c})))),e.__construct&&e.__construct(...t),e}(Reflect.construct(t,r,o),e)}},e);return Reflect.construct(c,r)}}function y(e,t){return(n,o,c)=>{const s=Reflect.get(n,o,c),i=a(t,"class"===e?"static-member":"member-function",o);if(!i.length)return s;const u=r(s,i,c);return"object"==typeof s?u():u}}var b=new class{constructor(){this.generated=[]}setPlugins(e){l.setPlugins(e.map((e=>e.default||e)))}Extensible(n=class{}){if(n[e])return n;const{name:r}=n,{value:o=Symbol(`Cache Identity ${r}`)}=Object.getOwnPropertyDescriptor(n,t)||{};if(!this.generated[o]){const r=class extends n{constructor(...e){super(...e);const{__namespaces__:t}=Object.getPrototypeOf(this),n=(e=>y("instance",e))(t);return new Proxy(this,{get:n})}__construct(){}};r[e]=!0,this.generated[o]=r,Object.defineProperty(n,t,{value:o,writable:!1})}return this.generated[o]}middleware(e,t){try{!function(e,t){const n=Object.assign([],Reflect.get(e.prototype,"__namespaces__"));n.includes(t)||n.push(t),e.prototype.__namespaces__=n}(e,t);const n=d(e),r={get:y("class",n),apply:f(n),construct:g(n)};return new Proxy(e,r)}catch(n){return console.log(`Failed to apply middleware to: ${e} (${t}).`),console.log(n),e}}};export default b;
