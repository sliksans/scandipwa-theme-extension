{"ast":null,"code":"/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\nimport CartQuery from \"/home/arturs/scandiweb/scandipwa/src/query/Cart.query\";\nimport ConfigQuery from \"/home/arturs/scandiweb/scandipwa/src/query/Config.query\";\nimport RegionQuery from \"/home/arturs/scandiweb/scandipwa/src/query/Region.query\";\nimport ReviewQuery from \"/home/arturs/scandiweb/scandipwa/src/query/Review.query\";\nimport { updateConfig } from \"/home/arturs/scandiweb/scandipwa/src/store/Config/Config.action\";\nimport { showNotification } from \"/home/arturs/scandiweb/scandipwa/src/store/Notification/Notification.action\";\nimport BrowserDatabase from \"/home/arturs/scandiweb/scandipwa/src/util/BrowserDatabase\";\nimport { setCurrency } from \"/home/arturs/scandiweb/scandipwa/src/util/Currency\";\nimport { fetchMutation, QueryDispatcher } from \"/home/arturs/scandiweb/scandipwa/src/util/Request\";\nimport { ONE_MONTH_IN_SECONDS } from \"/home/arturs/scandiweb/scandipwa/src/util/Request/QueryDispatcher\";\n/** #namespace Store/Config/Dispatcher */\n\nexport const ConfigDispatcher = Mosaic.middleware(class ConfigDispatcher_ extends Mosaic.Extensible(QueryDispatcher) {\n  __construct() {\n    super.__construct('Config');\n  }\n\n  static updateCurrency(dispatch, options) {\n    const {\n      currencyCode\n    } = options;\n    return fetchMutation(ConfigQuery.getSaveSelectedCurrencyMutation(currencyCode)).then(setCurrency(currencyCode), dispatch(updateConfig()));\n  }\n\n  onSuccess(data, dispatch) {\n    if (data) {\n      BrowserDatabase.setItem(data, 'config', ONE_MONTH_IN_SECONDS);\n      dispatch(updateConfig(data));\n    }\n  }\n\n  onError(error, dispatch) {\n    dispatch(showNotification('error', __('Error fetching Config!'), error));\n  }\n\n  prepareRequest() {\n    return [RegionQuery.getCountriesQuery(), ReviewQuery.getRatingQuery(), ConfigQuery.getQuery(), ConfigQuery.getCheckoutAgreements(), ConfigQuery.getCurrencyData(), CartQuery.getCartDisplayConfig()];\n  }\n\n}, \"Store/Config/Dispatcher\");\nexport default new ConfigDispatcher();","map":{"version":3,"sources":["/home/arturs/scandiweb/scandipwa/node_modules/@scandipwa/scandipwa/src/store/Config/Config.dispatcher.js"],"names":["CartQuery","ConfigQuery","RegionQuery","ReviewQuery","updateConfig","showNotification","BrowserDatabase","setCurrency","fetchMutation","QueryDispatcher","ONE_MONTH_IN_SECONDS","__construct","updateCurrency","dispatch","options","currencyCode","getSaveSelectedCurrencyMutation","then","onSuccess","data","setItem","onError","error","__","prepareRequest","getCountriesQuery","getRatingQuery","getQuery","getCheckoutAgreements","getCurrencyData","getCartDisplayConfig","ConfigDispatcher"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,OAAOA,SAAP;AACA,OAAOC,WAAP;AACA,OAAOC,WAAP;AACA,OAAOC,WAAP;AACA,SAASC,YAAT;AACA,SAASC,gBAAT;AACA,OAAOC,eAAP;AACA,SAASC,WAAT;AACA,SAASC,aAAT,EAAwBC,eAAxB;AACA,SAASC,oBAAT;AAEA;;AACA,oGAAsCD,eAAtC,EAAsD;AAClDE,EAAAA,WAAW,GAAG;AACV,UAAMA,WAAN,CAAkB,QAAlB;AACH;;AAEoB,SAAdC,cAAc,CAACC,QAAD,EAAWC,OAAX,EAAoB;AACrC,UAAM;AAAEC,MAAAA;AAAF,QAAmBD,OAAzB;AAEA,WAAON,aAAa,CAACP,WAAW,CAACe,+BAAZ,CACjBD,YADiB,CAAD,CAAb,CAEJE,IAFI,CAGHV,WAAW,CAACQ,YAAD,CAHR,EAIHF,QAAQ,CAACT,YAAY,EAAb,CAJL,CAAP;AAMH;;AAEDc,EAAAA,SAAS,CAACC,IAAD,EAAON,QAAP,EAAiB;AACtB,QAAIM,IAAJ,EAAU;AACNb,MAAAA,eAAe,CAACc,OAAhB,CAAwBD,IAAxB,EAA8B,QAA9B,EAAwCT,oBAAxC;AACAG,MAAAA,QAAQ,CAACT,YAAY,CAACe,IAAD,CAAb,CAAR;AACH;AACJ;;AAEDE,EAAAA,OAAO,CAACC,KAAD,EAAQT,QAAR,EAAkB;AACrBA,IAAAA,QAAQ,CAACR,gBAAgB,CAAC,OAAD,EAAUkB,EAAE,CAAC,wBAAD,CAAZ,EAAwCD,KAAxC,CAAjB,CAAR;AACH;;AAEDE,EAAAA,cAAc,GAAG;AACb,WAAO,CACHtB,WAAW,CAACuB,iBAAZ,EADG,EAEHtB,WAAW,CAACuB,cAAZ,EAFG,EAGHzB,WAAW,CAAC0B,QAAZ,EAHG,EAIH1B,WAAW,CAAC2B,qBAAZ,EAJG,EAKH3B,WAAW,CAAC4B,eAAZ,EALG,EAMH7B,SAAS,CAAC8B,oBAAV,EANG,CAAP;AAQH;;AApCiD,CAAtD;AAuCA,eAAe,IAAIC,gBAAJ,EAAf","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport CartQuery from 'Query/Cart.query';\nimport ConfigQuery from 'Query/Config.query';\nimport RegionQuery from 'Query/Region.query';\nimport ReviewQuery from 'Query/Review.query';\nimport { updateConfig } from 'Store/Config/Config.action';\nimport { showNotification } from 'Store/Notification/Notification.action';\nimport BrowserDatabase from 'Util/BrowserDatabase';\nimport { setCurrency } from 'Util/Currency';\nimport { fetchMutation, QueryDispatcher } from 'Util/Request';\nimport { ONE_MONTH_IN_SECONDS } from 'Util/Request/QueryDispatcher';\n\n/** @namespace Store/Config/Dispatcher */\nexport class ConfigDispatcher extends QueryDispatcher {\n    __construct() {\n        super.__construct('Config');\n    }\n\n    static updateCurrency(dispatch, options) {\n        const { currencyCode } = options;\n\n        return fetchMutation(ConfigQuery.getSaveSelectedCurrencyMutation(\n            currencyCode\n        )).then(\n            setCurrency(currencyCode),\n            dispatch(updateConfig())\n        );\n    }\n\n    onSuccess(data, dispatch) {\n        if (data) {\n            BrowserDatabase.setItem(data, 'config', ONE_MONTH_IN_SECONDS);\n            dispatch(updateConfig(data));\n        }\n    }\n\n    onError(error, dispatch) {\n        dispatch(showNotification('error', __('Error fetching Config!'), error));\n    }\n\n    prepareRequest() {\n        return [\n            RegionQuery.getCountriesQuery(),\n            ReviewQuery.getRatingQuery(),\n            ConfigQuery.getQuery(),\n            ConfigQuery.getCheckoutAgreements(),\n            ConfigQuery.getCurrencyData(),\n            CartQuery.getCartDisplayConfig()\n        ];\n    }\n}\n\nexport default new ConfigDispatcher();\n"]},"metadata":{},"sourceType":"module"}