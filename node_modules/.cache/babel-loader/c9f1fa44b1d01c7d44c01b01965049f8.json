{"ast":null,"code":"var _class,\n    _temp,\n    _jsxFileName = \"/home/arturs/scandiweb/scandipwa/node_modules/@scandipwa/scandipwa/src/component/ProductCard/ProductCard.container.js\";\n\n/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\nimport { Subscribe } from 'unstated';\nimport SharedTransitionContainer from \"/home/arturs/scandiweb/scandipwa/src/component/SharedTransition/SharedTransition.unstated\";\nimport { DeviceType } from \"/home/arturs/scandiweb/scandipwa/src/type/Device\";\nimport { FilterType, ProductType } from \"/home/arturs/scandiweb/scandipwa/src/type/ProductList\";\nimport history from \"/home/arturs/scandiweb/scandipwa/src/util/History\";\nimport { CONFIGURABLE, getVariantsIndexes } from \"/home/arturs/scandiweb/scandipwa/src/util/Product\";\nimport { appendWithStoreCode, objectToUri } from \"/home/arturs/scandiweb/scandipwa/src/util/Url\";\nimport ProductCard from \"./ProductCard.component\";\nimport { IN_STOCK } from \"./ProductCard.config\";\nexport const CartDispatcher = import(\n/* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n\"/home/arturs/scandiweb/scandipwa/src/store/Cart/Cart.dispatcher\");\n/** #namespace Component/ProductCard/Container/mapStateToProps */\n\nexport const mapStateToProps = Mosaic.middleware(function (state) {\n  return {\n    device: state.ConfigReducer.device,\n    base_link_url: state.ConfigReducer.base_link_url || '',\n    product_use_categories: state.ConfigReducer.product_use_categories || false,\n    category_url_suffix: state.ConfigReducer.category_url_suffix,\n    isWishlistEnabled: state.ConfigReducer.wishlist_general_active\n  };\n}, \"Component/ProductCard/Container/mapStateToProps\");\n/** #namespace Component/ProductCard/Container/mapDispatchToProps */\n\nexport const mapDispatchToProps = Mosaic.middleware(function (dispatch) {\n  return {\n    addProduct: function (options) {\n      return CartDispatcher.then(function ({\n        default: dispatcher\n      }) {\n        return dispatcher.addProductToCart(dispatch, options);\n      });\n    }\n  };\n}, \"Component/ProductCard/Container/mapDispatchToProps\");\n/** #namespace Component/ProductCard/Container */\n\nvar _checkBEM = require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;\n\nexport const ProductCardContainer = Mosaic.middleware((_temp = _class = class ProductCardContainer_ extends Mosaic.Extensible(PureComponent) {\n  constructor(...args) {\n    var _this;\n\n    super(...args);\n    _this = this;\n    this.containerFunctions = {\n      getAttribute: this.getAttribute.bind(this),\n      isConfigurableProductOutOfStock: this.isConfigurableProductOutOfStock.bind(this),\n      isBundleProductOutOfStock: this.isConfigurableProductOutOfStock.bind(this)\n    };\n\n    this.containerProps = function () {\n      return {\n        availableVisualOptions: _this._getAvailableVisualOptions(),\n        currentVariantIndex: _this._getCurrentVariantIndex(),\n        productOrVariant: _this._getProductOrVariant(),\n        thumbnail: _this._getThumbnail(),\n        linkTo: _this._getLinkTo()\n      };\n    };\n  }\n\n  getAttribute(code) {\n    const {\n      selectedFilters\n    } = this.props;\n\n    if (!Object.keys(selectedFilters).length) {\n      const {\n        product: {\n          attributes = {}\n        }\n      } = this.props;\n      return attributes[code];\n    }\n\n    const currentVariantIndex = this._getCurrentVariantIndex();\n\n    const {\n      product,\n      product: {\n        variants = []\n      }\n    } = this.props;\n    const {\n      attributes: parentAttributes = {}\n    } = product;\n    const {\n      attributes = parentAttributes\n    } = variants[currentVariantIndex] || product;\n    const {\n      attribute_options = {}\n    } = parentAttributes[code] || {};\n    return { ...attributes[code],\n      attribute_options\n    };\n  }\n\n  _getLinkTo() {\n    const {\n      base_link_url,\n      product_use_categories,\n      category_url_suffix,\n      product: {\n        url,\n        url_rewrites = []\n      },\n      product\n    } = this.props;\n    const {\n      pathname: storePrefix\n    } = new URL(base_link_url || window.location.origin);\n    const {\n      location: {\n        pathname\n      }\n    } = history;\n\n    if (!url) {\n      return undefined;\n    }\n\n    const {\n      parameters\n    } = this._getConfigurableParameters();\n\n    const {\n      state: {\n        category = null\n      } = {}\n    } = history.location;\n    const categoryUrlPart = pathname.replace(storePrefix, '').replace(category_url_suffix, '');\n    const productUrl = `${categoryUrlPart}/${url.replace(storePrefix, '')}`; // if 'Product Use Categories' is enabled then use the current window location to see if the product\n    // has any url_rewrite for that path. (if not then just use the default url)\n\n    const rewriteUrl = url_rewrites.find(function ({\n      url\n    }) {\n      return url.includes(productUrl);\n    }) || {};\n    const rewriteUrlPath = product_use_categories ? rewriteUrl.url && appendWithStoreCode(rewriteUrl.url) || url : url;\n    return {\n      pathname: rewriteUrlPath,\n      state: {\n        product,\n        prevCategoryId: category\n      },\n      search: objectToUri(parameters)\n    };\n  }\n\n  _getCurrentVariantIndex() {\n    const {\n      index\n    } = this._getConfigurableParameters();\n\n    return index;\n  }\n\n  _getConfigurableParameters() {\n    const {\n      product: {\n        variants = []\n      },\n      selectedFilters = {}\n    } = this.props;\n    const filterKeys = Object.keys(selectedFilters);\n\n    if (filterKeys.length === 0) {\n      return {\n        indexes: [],\n        parameters: {}\n      };\n    }\n\n    const indexes = getVariantsIndexes(variants, selectedFilters, true);\n    const [index] = indexes;\n\n    if (!variants[index]) {\n      return {\n        indexes: [],\n        parameters: {}\n      };\n    }\n\n    const {\n      attributes\n    } = variants[index];\n    const parameters = Object.entries(attributes).reduce(function (parameters, [key, {\n      attribute_value\n    }]) {\n      if (filterKeys.includes(key)) {\n        return { ...parameters,\n          [key]: attribute_value\n        };\n      }\n\n      return parameters;\n    }, {});\n    return {\n      indexes,\n      index,\n      parameters\n    };\n  }\n\n  _isThumbnailAvailable(path) {\n    return path && path !== 'no_selection';\n  }\n\n  _getThumbnail() {\n    const product = this._getProductOrVariant();\n\n    const {\n      small_image: {\n        url\n      } = {}\n    } = product;\n\n    if (this._isThumbnailAvailable(url)) {\n      return url;\n    } // If thumbnail is, missing we try to get image from parent\n\n\n    const {\n      product: {\n        small_image: {\n          url: parentUrl\n        } = {}\n      }\n    } = this.props;\n\n    if (this._isThumbnailAvailable(parentUrl)) {\n      return parentUrl;\n    }\n\n    return '';\n  }\n\n  _getProductOrVariant() {\n    const {\n      product: {\n        type_id,\n        variants\n      },\n      product\n    } = this.props;\n\n    if (type_id === CONFIGURABLE && (variants === null || variants === void 0 ? void 0 : variants.length)) {\n      return variants[this._getCurrentVariantIndex()] || product || {};\n    }\n\n    return product || {};\n  }\n\n  _getAvailableVisualOptions() {\n    const {\n      product: {\n        configurable_options = {}\n      }\n    } = this.props;\n\n    if (Object.keys(configurable_options).length === 0) {\n      return [];\n    } // Find first option that has swatch_data in attribute_options property\n\n\n    const optionWithSwatchData = Object.values(configurable_options).find(function (option) {\n      const {\n        attribute_options = {}\n      } = option;\n      return Object.values(attribute_options).some(function ({\n        swatch_data\n      }) {\n        return swatch_data;\n      });\n    });\n    const {\n      attribute_options = {}\n    } = optionWithSwatchData || {};\n    return Object.values(attribute_options).reduce(function (acc, option) {\n      const {\n        swatch_data,\n        label\n      } = option;\n      const {\n        type,\n        value\n      } = swatch_data || {};\n\n      if (type && value) {\n        acc.push({\n          value,\n          label,\n          type\n        });\n      }\n\n      return acc;\n    }, []);\n  }\n\n  isConfigurableProductOutOfStock() {\n    const {\n      product: {\n        variants\n      },\n      isPreview\n    } = this.props;\n\n    if (isPreview) {\n      return true;\n    }\n\n    const variantsInStock = variants.filter(function (productVariant) {\n      return productVariant.stock_status === IN_STOCK;\n    });\n    return variantsInStock.length === 0;\n  }\n\n  isBundleProductOutOfStock() {\n    const {\n      product: {\n        items\n      }\n    } = this.props;\n\n    if (items.length === 0) {\n      return true;\n    }\n\n    const {\n      options\n    } = items[0];\n    const optionsInStock = options.filter(function (option) {\n      return option.product.stock_status === IN_STOCK;\n    });\n    return optionsInStock.length === 0;\n  }\n\n  render() {\n    var _this2 = this;\n\n    return /*#__PURE__*/_checkBEM(React, Subscribe, {\n      to: [SharedTransitionContainer],\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 13\n      }\n    }, function ({\n      registerSharedElement\n    }) {\n      return /*#__PURE__*/_checkBEM(React, ProductCard, Object.assign({}, _this2.props, {\n        registerSharedElement\n      }, _this2.containerFunctions, _this2.containerProps(), {\n        __self: _this2,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 263,\n          columnNumber: 21\n        }\n      }));\n    });\n  }\n\n}, _class.propTypes = {\n  product: ProductType,\n  selectedFilters: FilterType,\n  device: DeviceType.isRequired,\n  product_use_categories: PropTypes.bool.isRequired,\n  category_url_suffix: PropTypes.string.isRequired,\n  base_link_url: PropTypes.string.isRequired,\n  isWishlistEnabled: PropTypes.bool.isRequired,\n  isPreview: PropTypes.bool\n}, _class.defaultProps = {\n  product: {},\n  selectedFilters: {},\n  isPreview: false\n}, _temp), \"Component/ProductCard/Container\");\nexport default connect(mapStateToProps, mapDispatchToProps)(ProductCardContainer);","map":{"version":3,"sources":["/home/arturs/scandiweb/scandipwa/node_modules/@scandipwa/scandipwa/src/component/ProductCard/ProductCard.container.js"],"names":["PropTypes","PureComponent","connect","Subscribe","SharedTransitionContainer","DeviceType","FilterType","ProductType","history","CONFIGURABLE","getVariantsIndexes","appendWithStoreCode","objectToUri","ProductCard","IN_STOCK","CartDispatcher","mapStateToProps","state","device","ConfigReducer","base_link_url","product_use_categories","category_url_suffix","isWishlistEnabled","wishlist_general_active","mapDispatchToProps","dispatch","addProduct","options","then","default","dispatcher","addProductToCart","containerFunctions","getAttribute","bind","isConfigurableProductOutOfStock","isBundleProductOutOfStock","containerProps","availableVisualOptions","_getAvailableVisualOptions","currentVariantIndex","_getCurrentVariantIndex","productOrVariant","_getProductOrVariant","thumbnail","_getThumbnail","linkTo","_getLinkTo","code","selectedFilters","props","Object","keys","length","product","attributes","variants","parentAttributes","attribute_options","url","url_rewrites","pathname","storePrefix","URL","window","location","origin","undefined","parameters","_getConfigurableParameters","category","categoryUrlPart","replace","productUrl","rewriteUrl","find","includes","rewriteUrlPath","prevCategoryId","search","index","filterKeys","indexes","entries","reduce","key","attribute_value","_isThumbnailAvailable","path","small_image","parentUrl","type_id","configurable_options","optionWithSwatchData","values","option","some","swatch_data","acc","label","type","value","push","isPreview","variantsInStock","filter","productVariant","stock_status","items","optionsInStock","render","registerSharedElement","propTypes","isRequired","bool","string","defaultProps","ProductCardContainer"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\nimport { Subscribe } from 'unstated';\n\nimport SharedTransitionContainer from 'Component/SharedTransition/SharedTransition.unstated';\nimport { DeviceType } from 'Type/Device';\nimport { FilterType, ProductType } from 'Type/ProductList';\nimport history from 'Util/History';\nimport { CONFIGURABLE, getVariantsIndexes } from 'Util/Product';\nimport { appendWithStoreCode, objectToUri } from 'Util/Url';\n\nimport ProductCard from './ProductCard.component';\nimport { IN_STOCK } from './ProductCard.config';\n\nexport const CartDispatcher = import(\n    /* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n    'Store/Cart/Cart.dispatcher'\n);\n\n/** @namespace Component/ProductCard/Container/mapStateToProps */\nexport const mapStateToProps = (state) => ({\n    device: state.ConfigReducer.device,\n    base_link_url: state.ConfigReducer.base_link_url || '',\n    product_use_categories: state.ConfigReducer.product_use_categories || false,\n    category_url_suffix: state.ConfigReducer.category_url_suffix,\n    isWishlistEnabled: state.ConfigReducer.wishlist_general_active\n});\n\n/** @namespace Component/ProductCard/Container/mapDispatchToProps */\nexport const mapDispatchToProps = (dispatch) => ({\n    addProduct: (options) => CartDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.addProductToCart(dispatch, options)\n    )\n});\n\n/** @namespace Component/ProductCard/Container */\nexport class ProductCardContainer extends PureComponent {\n    static propTypes = {\n        product: ProductType,\n        selectedFilters: FilterType,\n        device: DeviceType.isRequired,\n        product_use_categories: PropTypes.bool.isRequired,\n        category_url_suffix: PropTypes.string.isRequired,\n        base_link_url: PropTypes.string.isRequired,\n        isWishlistEnabled: PropTypes.bool.isRequired,\n        isPreview: PropTypes.bool\n    };\n\n    static defaultProps = {\n        product: {},\n        selectedFilters: {},\n        isPreview: false\n    };\n\n    containerFunctions = {\n        getAttribute: this.getAttribute.bind(this),\n        isConfigurableProductOutOfStock: this.isConfigurableProductOutOfStock.bind(this),\n        isBundleProductOutOfStock: this.isConfigurableProductOutOfStock.bind(this)\n    };\n\n    getAttribute(code) {\n        const { selectedFilters } = this.props;\n\n        if (!Object.keys(selectedFilters).length) {\n            const { product: { attributes = {} } } = this.props;\n            return attributes[code];\n        }\n\n        const currentVariantIndex = this._getCurrentVariantIndex();\n        const { product, product: { variants = [] } } = this.props;\n        const { attributes: parentAttributes = {} } = product;\n        const { attributes = parentAttributes } = variants[currentVariantIndex] || product;\n        const { attribute_options = {} } = parentAttributes[code] || {};\n\n        return {\n            ...attributes[code],\n            attribute_options\n        };\n    }\n\n    containerProps = () => ({\n        availableVisualOptions: this._getAvailableVisualOptions(),\n        currentVariantIndex: this._getCurrentVariantIndex(),\n        productOrVariant: this._getProductOrVariant(),\n        thumbnail: this._getThumbnail(),\n        linkTo: this._getLinkTo()\n    });\n\n    _getLinkTo() {\n        const {\n            base_link_url,\n            product_use_categories,\n            category_url_suffix,\n            product: { url, url_rewrites = [] },\n            product\n        } = this.props;\n        const { pathname: storePrefix } = new URL(base_link_url || window.location.origin);\n        const { location: { pathname } } = history;\n\n        if (!url) {\n            return undefined;\n        }\n\n        const { parameters } = this._getConfigurableParameters();\n        const { state: { category = null } = {} } = history.location;\n        const categoryUrlPart = pathname.replace(storePrefix, '').replace(category_url_suffix, '');\n        const productUrl = `${categoryUrlPart}/${url.replace(storePrefix, '')}`;\n\n        // if 'Product Use Categories' is enabled then use the current window location to see if the product\n        // has any url_rewrite for that path. (if not then just use the default url)\n        const rewriteUrl = url_rewrites.find(({ url }) => url.includes(productUrl)) || {};\n        const rewriteUrlPath = product_use_categories\n            ? (rewriteUrl.url && appendWithStoreCode(rewriteUrl.url)) || url\n            : url;\n\n        return {\n            pathname: rewriteUrlPath,\n            state: { product, prevCategoryId: category },\n            search: objectToUri(parameters)\n        };\n    }\n\n    _getCurrentVariantIndex() {\n        const { index } = this._getConfigurableParameters();\n        return index;\n    }\n\n    _getConfigurableParameters() {\n        const { product: { variants = [] }, selectedFilters = {} } = this.props;\n        const filterKeys = Object.keys(selectedFilters);\n\n        if (filterKeys.length === 0) {\n            return { indexes: [], parameters: {} };\n        }\n\n        const indexes = getVariantsIndexes(variants, selectedFilters, true);\n        const [index] = indexes;\n\n        if (!variants[index]) {\n            return { indexes: [], parameters: {} };\n        }\n        const { attributes } = variants[index];\n\n        const parameters = Object.entries(attributes)\n            .reduce((parameters, [key, { attribute_value }]) => {\n                if (filterKeys.includes(key)) {\n                    return { ...parameters, [key]: attribute_value };\n                }\n\n                return parameters;\n            }, {});\n\n        return { indexes, index, parameters };\n    }\n\n    _isThumbnailAvailable(path) {\n        return path && path !== 'no_selection';\n    }\n\n    _getThumbnail() {\n        const product = this._getProductOrVariant();\n        const { small_image: { url } = {} } = product;\n        if (this._isThumbnailAvailable(url)) {\n            return url;\n        }\n\n        // If thumbnail is, missing we try to get image from parent\n        const { product: { small_image: { url: parentUrl } = {} } } = this.props;\n        if (this._isThumbnailAvailable(parentUrl)) {\n            return parentUrl;\n        }\n\n        return '';\n    }\n\n    _getProductOrVariant() {\n        const { product: { type_id, variants }, product } = this.props;\n\n        if (type_id === CONFIGURABLE && variants?.length) {\n            return variants[this._getCurrentVariantIndex()] || product || {};\n        }\n\n        return product || {};\n    }\n\n    _getAvailableVisualOptions() {\n        const { product: { configurable_options = {} } } = this.props;\n\n        if (Object.keys(configurable_options).length === 0) {\n            return [];\n        }\n\n        // Find first option that has swatch_data in attribute_options property\n        const optionWithSwatchData = Object.values(configurable_options).find((option) => {\n            const { attribute_options = {} } = option;\n\n            return Object.values(attribute_options).some(({ swatch_data }) => swatch_data);\n        });\n\n        const { attribute_options = {} } = optionWithSwatchData || {};\n\n        return Object.values(attribute_options).reduce(\n            (acc, option) => {\n                const {\n                    swatch_data,\n                    label\n                } = option;\n\n                const { type, value } = swatch_data || {};\n\n                if (type && value) {\n                    acc.push({ value, label, type });\n                }\n\n                return acc;\n            },\n            []\n        );\n    }\n\n    isConfigurableProductOutOfStock() {\n        const { product: { variants }, isPreview } = this.props;\n\n        if (isPreview) {\n            return true;\n        }\n\n        const variantsInStock = variants.filter((productVariant) => productVariant.stock_status === IN_STOCK);\n\n        return variantsInStock.length === 0;\n    }\n\n    isBundleProductOutOfStock() {\n        const { product: { items } } = this.props;\n\n        if (items.length === 0) {\n            return true;\n        }\n\n        const { options } = items[0];\n\n        const optionsInStock = options.filter((option) => option.product.stock_status === IN_STOCK);\n\n        return optionsInStock.length === 0;\n    }\n\n    render() {\n        return (\n            <Subscribe to={ [SharedTransitionContainer] }>\n                { ({ registerSharedElement }) => (\n                    <ProductCard\n                      { ...{ ...this.props, registerSharedElement } }\n                      { ...this.containerFunctions }\n                      { ...this.containerProps() }\n                    />\n                ) }\n            </Subscribe>\n        );\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ProductCardContainer);\n"]},"metadata":{},"sourceType":"module"}