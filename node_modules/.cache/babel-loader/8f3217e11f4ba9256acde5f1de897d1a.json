{"ast":null,"code":"var _class,\n    _temp,\n    _jsxFileName = \"/home/arturs/scandiweb/extension/node_modules/@scandipwa/scandipwa/src/component/MyAccountNewsletterSubscription/MyAccountNewsletterSubscription.container.js\";\n\n/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\nimport PropTypes from 'prop-types';\nimport React, { PureComponent } from 'react';\nimport { connect } from 'react-redux';\nimport Loader from \"/home/arturs/scandiweb/extension/src/component/Loader\";\nimport MyAccountQuery from \"/home/arturs/scandiweb/extension/src/query/MyAccount.query\";\nimport { updateCustomerDetails } from \"/home/arturs/scandiweb/extension/src/store/MyAccount/MyAccount.action\";\nimport { CUSTOMER } from \"/home/arturs/scandiweb/extension/src/store/MyAccount/MyAccount.dispatcher\";\nimport { showNotification } from \"/home/arturs/scandiweb/extension/src/store/Notification/Notification.action\";\nimport { customerType } from \"/home/arturs/scandiweb/extension/src/type/Account\";\nimport { isSignedIn } from \"/home/arturs/scandiweb/extension/src/util/Auth\";\nimport BrowserDatabase from \"/home/arturs/scandiweb/extension/src/util/BrowserDatabase/BrowserDatabase\";\nimport { fetchMutation, getErrorMessage } from \"/home/arturs/scandiweb/extension/src/util/Request\";\nimport { ONE_MONTH_IN_SECONDS } from \"/home/arturs/scandiweb/extension/src/util/Request/QueryDispatcher\";\nimport MyAccountNewsletterSubscription from \"./MyAccountNewsletterSubscription.component\";\n/** #namespace Component/MyAccountNewsletterSubscription/Container/mapStateToProps */\n\nexport const mapStateToProps = Mosaic.middleware(function (state) {\n  return {\n    customer: state.MyAccountReducer.customer,\n    newsletterConfirmStatus: state.ConfigReducer.newsletter_subscription_confirm\n  };\n}, \"Component/MyAccountNewsletterSubscription/Container/mapStateToProps\");\n/** #namespace Component/MyAccountNewsletterSubscription/Container/mapDispatchToProps */\n\nexport const mapDispatchToProps = Mosaic.middleware(function (dispatch) {\n  return {\n    updateCustomer: function (customer) {\n      return dispatch(updateCustomerDetails(customer));\n    },\n    showErrorNotification: function (error) {\n      return dispatch(showNotification('error', getErrorMessage(error)));\n    },\n    showSuccessNotification: function (message) {\n      return dispatch(showNotification('success', message));\n    }\n  };\n}, \"Component/MyAccountNewsletterSubscription/Container/mapDispatchToProps\");\n/** #namespace Component/MyAccountNewsletterSubscription/Container */\n\nvar _checkBEM = require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;\n\nexport const MyAccountNewsletterSubscriptionContainer = Mosaic.middleware((_temp = _class = class MyAccountNewsletterSubscriptionContainer_ extends Mosaic.Extensible(PureComponent) {\n  constructor(...args) {\n    var _this;\n\n    super(...args);\n    _this = this;\n    this.containerFunctions = {\n      onCustomerSave: this.onCustomerSave.bind(this)\n    };\n    this.state = {\n      isLoading: false\n    };\n\n    this.onError = function () {\n      const {\n        showErrorNotification\n      } = _this.props;\n\n      _this.setState({\n        isLoading: false\n      }, function () {\n        showErrorNotification(__('We are experiencing issues, please try again later'));\n      });\n    };\n  }\n\n  showSubscriptionUpdateNotification(isSubscribed, wasSubscribed) {\n    const {\n      showSuccessNotification,\n      newsletterConfirmStatus\n    } = this.props;\n\n    if (!isSubscribed && wasSubscribed) {\n      showSuccessNotification(__('We have removed your newsletter subscription.'));\n    } else if (isSubscribed && !newsletterConfirmStatus && !wasSubscribed) {\n      showSuccessNotification(__('We have saved your subscription'));\n    } else if (!isSubscribed && newsletterConfirmStatus) {\n      showSuccessNotification(__('A subscription confirmation email has been sent!'));\n    } else {\n      showSuccessNotification(__('We have updated your subscription.'));\n    }\n  }\n\n  onCustomerSave(customer) {\n    var _this2 = this;\n\n    const {\n      updateCustomer,\n      customer: {\n        is_subscribed: wasSubscribed\n      }\n    } = this.props;\n    const mutation = MyAccountQuery.getUpdateInformationMutation(customer);\n\n    if (!isSignedIn()) {\n      return null;\n    }\n\n    this.setState({\n      isLoading: true\n    });\n    return fetchMutation(mutation).then(\n    /** #namespace Component/MyAccountNewsletterSubscription/Container/fetchMutationThen */\n    Mosaic.middleware(function ({\n      updateCustomer: {\n        customer\n      }\n    }) {\n      BrowserDatabase.setItem(customer, CUSTOMER, ONE_MONTH_IN_SECONDS);\n      const {\n        is_subscribed\n      } = customer;\n\n      _this2.setState({\n        isLoading: false\n      }, function () {\n        updateCustomer(customer);\n\n        _this2.showSubscriptionUpdateNotification(is_subscribed, wasSubscribed);\n      });\n    }, \"Component/MyAccountNewsletterSubscription/Container/fetchMutationThen\"), this.onError);\n  }\n\n  render() {\n    const {\n      isLoading\n    } = this.state;\n    return /*#__PURE__*/_checkBEM(React, React.Fragment, null, /*#__PURE__*/_checkBEM(React, Loader, {\n      isLoading: isLoading,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/_checkBEM(React, MyAccountNewsletterSubscription, Object.assign({}, this.props, this.containerFunctions, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 17\n      }\n    })));\n  }\n\n}, _class.propTypes = {\n  customer: customerType.isRequired,\n  updateCustomer: PropTypes.func.isRequired,\n  showErrorNotification: PropTypes.func.isRequired,\n  showSuccessNotification: PropTypes.func.isRequired,\n  newsletterConfirmStatus: PropTypes.bool.isRequired\n}, _temp), \"Component/MyAccountNewsletterSubscription/Container\");\nexport default connect(mapStateToProps, mapDispatchToProps)(MyAccountNewsletterSubscriptionContainer);","map":{"version":3,"sources":["/home/arturs/scandiweb/extension/node_modules/@scandipwa/scandipwa/src/component/MyAccountNewsletterSubscription/MyAccountNewsletterSubscription.container.js"],"names":["PropTypes","React","PureComponent","connect","Loader","MyAccountQuery","updateCustomerDetails","CUSTOMER","showNotification","customerType","isSignedIn","BrowserDatabase","fetchMutation","getErrorMessage","ONE_MONTH_IN_SECONDS","MyAccountNewsletterSubscription","mapStateToProps","state","customer","MyAccountReducer","newsletterConfirmStatus","ConfigReducer","newsletter_subscription_confirm","mapDispatchToProps","dispatch","updateCustomer","showErrorNotification","error","showSuccessNotification","message","containerFunctions","onCustomerSave","bind","isLoading","onError","props","setState","__","showSubscriptionUpdateNotification","isSubscribed","wasSubscribed","is_subscribed","mutation","getUpdateInformationMutation","then","setItem","render","propTypes","isRequired","func","bool","MyAccountNewsletterSubscriptionContainer"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport React, { PureComponent } from 'react';\nimport { connect } from 'react-redux';\n\nimport Loader from 'Component/Loader';\nimport MyAccountQuery from 'Query/MyAccount.query';\nimport { updateCustomerDetails } from 'Store/MyAccount/MyAccount.action';\nimport { CUSTOMER } from 'Store/MyAccount/MyAccount.dispatcher';\nimport { showNotification } from 'Store/Notification/Notification.action';\nimport { customerType } from 'Type/Account';\nimport { isSignedIn } from 'Util/Auth';\nimport BrowserDatabase from 'Util/BrowserDatabase/BrowserDatabase';\nimport { fetchMutation, getErrorMessage } from 'Util/Request';\nimport { ONE_MONTH_IN_SECONDS } from 'Util/Request/QueryDispatcher';\n\nimport MyAccountNewsletterSubscription from './MyAccountNewsletterSubscription.component';\n\n/** @namespace Component/MyAccountNewsletterSubscription/Container/mapStateToProps */\nexport const mapStateToProps = (state) => ({\n    customer: state.MyAccountReducer.customer,\n    newsletterConfirmStatus: state.ConfigReducer.newsletter_subscription_confirm\n});\n\n/** @namespace Component/MyAccountNewsletterSubscription/Container/mapDispatchToProps */\nexport const mapDispatchToProps = (dispatch) => ({\n    updateCustomer: (customer) => dispatch(updateCustomerDetails(customer)),\n    showErrorNotification: (error) => dispatch(showNotification('error', getErrorMessage(error))),\n    showSuccessNotification: (message) => dispatch(showNotification('success', message))\n});\n\n/** @namespace Component/MyAccountNewsletterSubscription/Container */\nexport class MyAccountNewsletterSubscriptionContainer extends PureComponent {\n    static propTypes = {\n        customer: customerType.isRequired,\n        updateCustomer: PropTypes.func.isRequired,\n        showErrorNotification: PropTypes.func.isRequired,\n        showSuccessNotification: PropTypes.func.isRequired,\n        newsletterConfirmStatus: PropTypes.bool.isRequired\n    };\n\n    containerFunctions = {\n        onCustomerSave: this.onCustomerSave.bind(this)\n    };\n\n    state = {\n        isLoading: false\n    };\n\n    showSubscriptionUpdateNotification(isSubscribed, wasSubscribed) {\n        const {\n            showSuccessNotification,\n            newsletterConfirmStatus\n        } = this.props;\n\n        if (!isSubscribed && wasSubscribed) {\n            showSuccessNotification(__('We have removed your newsletter subscription.'));\n        } else if (isSubscribed && !newsletterConfirmStatus && !wasSubscribed) {\n            showSuccessNotification(__('We have saved your subscription'));\n        } else if (!isSubscribed && newsletterConfirmStatus) {\n            showSuccessNotification(__('A subscription confirmation email has been sent!'));\n        } else {\n            showSuccessNotification(__('We have updated your subscription.'));\n        }\n    }\n\n    onError = () => {\n        const { showErrorNotification } = this.props;\n\n        this.setState({ isLoading: false }, () => {\n            showErrorNotification(__('We are experiencing issues, please try again later'));\n        });\n    };\n\n    onCustomerSave(customer) {\n        const {\n            updateCustomer,\n            customer: {\n                is_subscribed: wasSubscribed\n            }\n        } = this.props;\n\n        const mutation = MyAccountQuery.getUpdateInformationMutation(customer);\n\n        if (!isSignedIn()) {\n            return null;\n        }\n\n        this.setState({ isLoading: true });\n\n        return fetchMutation(mutation).then(\n            /** @namespace Component/MyAccountNewsletterSubscription/Container/fetchMutationThen */\n            ({ updateCustomer: { customer } }) => {\n                BrowserDatabase.setItem(customer, CUSTOMER, ONE_MONTH_IN_SECONDS);\n                const { is_subscribed } = customer;\n\n                this.setState({ isLoading: false }, () => {\n                    updateCustomer(customer);\n                    this.showSubscriptionUpdateNotification(is_subscribed, wasSubscribed);\n                });\n            },\n            this.onError\n        );\n    }\n\n    render() {\n        const { isLoading } = this.state;\n\n        return (\n            <>\n                <Loader isLoading={ isLoading } />\n                <MyAccountNewsletterSubscription\n                  { ...this.props }\n                  { ...this.containerFunctions }\n                />\n            </>\n        );\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MyAccountNewsletterSubscriptionContainer);\n"]},"metadata":{},"sourceType":"module"}