{"ast":null,"code":"var _class,\n    _temp,\n    _jsxFileName = \"/home/arturs/scandiweb/scandipwa/node_modules/@scandipwa/scandipwa/src/component/AddToCart/AddToCart.container.js\";\n\n/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\nimport { IN_STOCK } from \"/home/arturs/scandiweb/scandipwa/src/component/ProductCard/ProductCard.config\";\nimport { showNotification } from \"/home/arturs/scandiweb/scandipwa/src/store/Notification/Notification.action\";\nimport { MixType } from \"/home/arturs/scandiweb/scandipwa/src/type/Common\";\nimport { ProductType } from \"/home/arturs/scandiweb/scandipwa/src/type/ProductList\";\nimport { isSignedIn } from \"/home/arturs/scandiweb/scandipwa/src/util/Auth\";\nimport { BUNDLE, CONFIGURABLE, GROUPED } from \"/home/arturs/scandiweb/scandipwa/src/util/Product\";\nimport AddToCart from \"./AddToCart.component\";\nexport const CartDispatcher = import(\n/* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n\"/home/arturs/scandiweb/scandipwa/src/store/Cart/Cart.dispatcher\");\nexport const WishlistDispatcher = import(\n/* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n\"/home/arturs/scandiweb/scandipwa/src/store/Wishlist/Wishlist.dispatcher\");\n/** #namespace Component/AddToCart/Container/mapStateToProps */\n\nexport const mapStateToProps = Mosaic.middleware(function (state) {\n  return {\n    wishlistItems: state.WishlistReducer.productsInWishlist\n  };\n}, \"Component/AddToCart/Container/mapStateToProps\");\n/** #namespace Component/AddToCart/Container/mapDispatchToProps */\n\nexport const mapDispatchToProps = Mosaic.middleware(function (dispatch) {\n  return {\n    addProduct: function (options) {\n      return CartDispatcher.then(function ({\n        default: dispatcher\n      }) {\n        return dispatcher.addProductToCart(dispatch, options);\n      });\n    },\n    removeFromWishlist: function (options) {\n      return WishlistDispatcher.then(function ({\n        default: dispatcher\n      }) {\n        return dispatcher.removeItemFromWishlist(dispatch, options);\n      });\n    },\n    showNotification: function (type, message) {\n      return dispatch(showNotification(type, message));\n    }\n  };\n}, \"Component/AddToCart/Container/mapDispatchToProps\");\n/* #namespace Component/AddToCart/Container */\n\nvar _checkBEM = require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;\n\nexport const AddToCartContainer = Mosaic.middleware((_temp = _class = class AddToCartContainer_ extends Mosaic.Extensible(PureComponent) {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      isLoading: false\n    };\n    this.validationMap = {\n      [CONFIGURABLE]: this.validateConfigurableProduct.bind(this),\n      [GROUPED]: this.validateGroupedProduct.bind(this),\n      [BUNDLE]: this.validateBundleProduct.bind(this)\n    };\n    this.addToCartHandlerMap = {\n      [CONFIGURABLE]: this.addConfigurableProductToCart.bind(this),\n      [GROUPED]: this.addGroupedProductToCart.bind(this)\n    };\n    this.containerFunctions = {\n      buttonClick: this.buttonClick.bind(this)\n    };\n  }\n\n  containerProps() {\n    const {\n      product,\n      mix,\n      disabled\n    } = this.props;\n    const {\n      isLoading\n    } = this.state;\n    return {\n      isLoading,\n      product,\n      mix,\n      disabled\n    };\n  }\n\n  validateConfigurableProduct() {\n    const {\n      configurableVariantIndex,\n      showNotification,\n      product: {\n        variants = []\n      }\n    } = this.props;\n\n    if (configurableVariantIndex < 0 || !variants[configurableVariantIndex]) {\n      showNotification('info', __('Please select product options!'));\n      return false;\n    }\n\n    const {\n      stock_status: configurableStock\n    } = variants[configurableVariantIndex];\n\n    if (configurableStock !== IN_STOCK) {\n      showNotification('info', __('Sorry! The selected product option is out of stock!'));\n      return false;\n    }\n\n    return true;\n  }\n\n  validateGroupedProduct() {\n    const {\n      groupedProductQuantity,\n      showNotification,\n      product: {\n        items = []\n      }\n    } = this.props;\n    const isAllItemsAvailable = items.some(function ({\n      product: {\n        id\n      }\n    }) {\n      return groupedProductQuantity[id];\n    });\n\n    if (!isAllItemsAvailable) {\n      showNotification('info', __('Please specify the quantity of product(s)!'));\n      return false;\n    }\n\n    return true;\n  }\n\n  validateBundleProduct() {\n    const {\n      productOptionsData,\n      showNotification\n    } = this.props;\n    const validateBundleOptions = this.validateCustomizableOptions(productOptionsData, true);\n\n    if (!validateBundleOptions) {\n      showNotification('info', __('Please select required option!'));\n      return false;\n    }\n\n    return true;\n  }\n\n  validateSimpleProduct() {\n    const {\n      productOptionsData,\n      showNotification\n    } = this.props;\n    const validateCustomizableOptions = this.validateCustomizableOptions(productOptionsData);\n\n    if (!validateCustomizableOptions) {\n      showNotification('info', __('Please select required option!'));\n      return false;\n    }\n\n    return true;\n  }\n\n  validateCustomizableOptions(productOptionsData, isBundle = false) {\n    const {\n      requiredOptions = {}\n    } = productOptionsData || {};\n\n    if (requiredOptions.length) {\n      const {\n        productOptions,\n        productOptionsMulti,\n        requiredOptions\n      } = productOptionsData;\n      return this.validateProductOptions([...(productOptions || []), ...(productOptionsMulti || [])], requiredOptions, isBundle);\n    }\n\n    return true;\n  }\n\n  validateProductOptions(items, requiredOptions, isBundle = false) {\n    // Make sure EVERY required option is FOUND in selected items\n    return requiredOptions.every(function (requiredOption) {\n      return items.find(function (item) {\n        const {\n          id,\n          option_id\n        } = item;\n        const matchWith = isBundle ? id : option_id;\n        return requiredOption === matchWith;\n      });\n    });\n  }\n\n  validateAddToCart() {\n    const {\n      product: {\n        type_id\n      }\n    } = this.props;\n    const validationRule = this.validationMap[type_id];\n\n    if (validationRule) {\n      return validationRule();\n    }\n\n    return this.validateSimpleProduct();\n  }\n\n  addGroupedProductToCart() {\n    var _this = this;\n\n    const {\n      product,\n      product: {\n        items\n      },\n      groupedProductQuantity,\n      addProduct\n    } = this.props;\n    Promise.all(items.map(function (item) {\n      const {\n        product: groupedProductItem\n      } = item;\n      const newProduct = { ...groupedProductItem,\n        parent: product\n      };\n      const quantity = groupedProductQuantity[groupedProductItem.id];\n\n      if (!quantity) {\n        return Promise.resolve();\n      }\n\n      return addProduct({\n        product: newProduct,\n        quantity\n      });\n    })).then(\n    /** #namespace Component/AddToCart/Container/addGroupedProductToCartPromiseAllThen */\n    Mosaic.middleware(function () {\n      return _this.afterAddToCart();\n    }, \"Component/AddToCart/Container/addGroupedProductToCartPromiseAllThen\"),\n    /** #namespace Component/AddToCart/Container/addGroupedProductToCartPromiseAllCatch */\n    Mosaic.middleware(function () {\n      return _this.resetLoading();\n    }, \"Component/AddToCart/Container/addGroupedProductToCartPromiseAllCatch\"));\n  }\n\n  addConfigurableProductToCart() {\n    var _this2 = this;\n\n    const {\n      product,\n      quantity,\n      addProduct,\n      configurableVariantIndex,\n      productOptionsData\n    } = this.props;\n    addProduct({\n      product: { ...product,\n        configurableVariantIndex\n      },\n      quantity,\n      productOptionsData\n    }).then(\n    /** #namespace Component/AddToCart/Container/addConfigurableProductToCartAddProductThen */\n    Mosaic.middleware(function () {\n      return _this2.afterAddToCart();\n    }, \"Component/AddToCart/Container/addConfigurableProductToCartAddProductThen\"),\n    /** #namespace Component/AddToCart/Container/addConfigurableProductToCartAddProductCatch */\n    Mosaic.middleware(function () {\n      return _this2.resetLoading();\n    }, \"Component/AddToCart/Container/addConfigurableProductToCartAddProductCatch\"));\n  }\n\n  addSimpleProductToCart() {\n    var _this3 = this;\n\n    const {\n      product,\n      quantity,\n      addProduct,\n      productOptionsData\n    } = this.props;\n    addProduct({\n      product,\n      quantity,\n      productOptionsData\n    }).then(\n    /** #namespace Component/AddToCart/Container/addSimpleProductToCartAddProductThen */\n    Mosaic.middleware(function () {\n      return _this3.afterAddToCart();\n    }, \"Component/AddToCart/Container/addSimpleProductToCartAddProductThen\"),\n    /** #namespace Component/AddToCart/Container/addSimpleProductToCartAddProductCatch */\n    Mosaic.middleware(function () {\n      return _this3.resetLoading();\n    }, \"Component/AddToCart/Container/addSimpleProductToCartAddProductCatch\"));\n  }\n\n  addProductToCart() {\n    const {\n      product: {\n        type_id\n      }\n    } = this.props;\n    const addToCartHandler = this.addToCartHandlerMap[type_id];\n\n    if (addToCartHandler) {\n      addToCartHandler();\n      return;\n    }\n\n    this.addSimpleProductToCart();\n  }\n\n  buttonClick() {\n    var _this4 = this;\n\n    const {\n      product: {\n        type_id\n      } = {},\n      onProductValidationError,\n      disableHandler\n    } = this.props;\n\n    if (disableHandler) {\n      return;\n    }\n\n    if (!this.validateAddToCart()) {\n      onProductValidationError(type_id);\n      return;\n    }\n\n    this.setState({\n      isLoading: true\n    }, function () {\n      return _this4.addProductToCart();\n    });\n  }\n\n  resetLoading() {\n    this.setState({\n      isLoading: false\n    });\n  }\n\n  removeProductFromWishlist() {\n    const {\n      wishlistItems,\n      removeFromWishlist,\n      configurableVariantIndex,\n      product: {\n        type_id,\n        variants = {}\n      } = {}\n    } = this.props;\n\n    if (type_id !== 'configurable') {\n      return;\n    }\n\n    const {\n      sku\n    } = variants[configurableVariantIndex];\n    const wishlistItemKey = Object.keys(wishlistItems).find(function (key) {\n      const {\n        wishlist: {\n          sku: wSku\n        }\n      } = wishlistItems[key];\n      return wSku === sku;\n    });\n\n    if (!isSignedIn() || wishlistItemKey === undefined) {\n      return;\n    }\n\n    const {\n      wishlist: {\n        id: item_id\n      }\n    } = wishlistItems[wishlistItemKey];\n    removeFromWishlist({\n      item_id,\n      sku,\n      noMessage: true\n    });\n  }\n\n  afterAddToCart() {\n    const {\n      showNotification,\n      setQuantityToDefault\n    } = this.props;\n    showNotification('success', __('Product added to cart!'));\n    setQuantityToDefault();\n    this.removeProductFromWishlist();\n    this.setState({\n      isLoading: false\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/_checkBEM(React, AddToCart, Object.assign({}, this.containerProps(), this.containerFunctions, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 396,\n        columnNumber: 13\n      }\n    }));\n  }\n\n}, _class.propTypes = {\n  isLoading: PropTypes.bool,\n  product: ProductType.isRequired,\n  quantity: PropTypes.number,\n  configurableVariantIndex: PropTypes.number,\n  groupedProductQuantity: PropTypes.objectOf(PropTypes.number).isRequired,\n  showNotification: PropTypes.func.isRequired,\n  setQuantityToDefault: PropTypes.func,\n  addProduct: PropTypes.func.isRequired,\n  removeFromWishlist: PropTypes.func.isRequired,\n  wishlistItems: PropTypes.objectOf(ProductType).isRequired,\n  onProductValidationError: PropTypes.func,\n  productOptionsData: PropTypes.object.isRequired,\n  disableHandler: PropTypes.bool,\n  mix: MixType,\n  disabled: PropTypes.bool\n}, _class.defaultProps = {\n  quantity: 1,\n  configurableVariantIndex: 0,\n  setQuantityToDefault: function () {},\n  onProductValidationError: function () {},\n  isLoading: false,\n  disableHandler: false,\n  mix: {},\n  disabled: false\n}, _temp), \"Component/AddToCart/Container\");\nexport default connect(mapStateToProps, mapDispatchToProps)(AddToCartContainer);","map":{"version":3,"sources":["/home/arturs/scandiweb/scandipwa/node_modules/@scandipwa/scandipwa/src/component/AddToCart/AddToCart.container.js"],"names":["PropTypes","PureComponent","connect","IN_STOCK","showNotification","MixType","ProductType","isSignedIn","BUNDLE","CONFIGURABLE","GROUPED","AddToCart","CartDispatcher","WishlistDispatcher","mapStateToProps","state","wishlistItems","WishlistReducer","productsInWishlist","mapDispatchToProps","dispatch","addProduct","options","then","default","dispatcher","addProductToCart","removeFromWishlist","removeItemFromWishlist","type","message","isLoading","validationMap","validateConfigurableProduct","bind","validateGroupedProduct","validateBundleProduct","addToCartHandlerMap","addConfigurableProductToCart","addGroupedProductToCart","containerFunctions","buttonClick","containerProps","product","mix","disabled","props","configurableVariantIndex","variants","__","stock_status","configurableStock","groupedProductQuantity","items","isAllItemsAvailable","some","id","productOptionsData","validateBundleOptions","validateCustomizableOptions","validateSimpleProduct","isBundle","requiredOptions","length","productOptions","productOptionsMulti","validateProductOptions","every","requiredOption","find","item","option_id","matchWith","validateAddToCart","type_id","validationRule","Promise","all","map","groupedProductItem","newProduct","parent","quantity","resolve","afterAddToCart","resetLoading","addSimpleProductToCart","addToCartHandler","onProductValidationError","disableHandler","setState","removeProductFromWishlist","sku","wishlistItemKey","Object","keys","key","wishlist","wSku","undefined","item_id","noMessage","setQuantityToDefault","render","propTypes","bool","isRequired","number","objectOf","func","object","defaultProps","AddToCartContainer"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\n\nimport { IN_STOCK } from 'Component/ProductCard/ProductCard.config';\nimport { showNotification } from 'Store/Notification/Notification.action';\nimport { MixType } from 'Type/Common';\nimport { ProductType } from 'Type/ProductList';\nimport { isSignedIn } from 'Util/Auth';\nimport {\n    BUNDLE,\n    CONFIGURABLE,\n    GROUPED\n} from 'Util/Product';\n\nimport AddToCart from './AddToCart.component';\n\nexport const CartDispatcher = import(\n    /* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n    'Store/Cart/Cart.dispatcher'\n);\n\nexport const WishlistDispatcher = import(\n    /* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n    'Store/Wishlist/Wishlist.dispatcher'\n);\n\n/** @namespace Component/AddToCart/Container/mapStateToProps */\nexport const mapStateToProps = (state) => ({\n    wishlistItems: state.WishlistReducer.productsInWishlist\n});\n\n/** @namespace Component/AddToCart/Container/mapDispatchToProps */\nexport const mapDispatchToProps = (dispatch) => ({\n    addProduct: (options) => CartDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.addProductToCart(dispatch, options)\n    ),\n    removeFromWishlist: (options) => WishlistDispatcher.then(\n        ({ default: dispatcher }) => dispatcher.removeItemFromWishlist(dispatch, options)\n    ),\n    showNotification: (type, message) => dispatch(showNotification(type, message))\n});\n\n/* @namespace Component/AddToCart/Container */\nexport class AddToCartContainer extends PureComponent {\n    static propTypes = {\n        isLoading: PropTypes.bool,\n        product: ProductType.isRequired,\n        quantity: PropTypes.number,\n        configurableVariantIndex: PropTypes.number,\n        groupedProductQuantity: PropTypes.objectOf(PropTypes.number).isRequired,\n        showNotification: PropTypes.func.isRequired,\n        setQuantityToDefault: PropTypes.func,\n        addProduct: PropTypes.func.isRequired,\n        removeFromWishlist: PropTypes.func.isRequired,\n        wishlistItems: PropTypes.objectOf(ProductType).isRequired,\n        onProductValidationError: PropTypes.func,\n        productOptionsData: PropTypes.object.isRequired,\n        disableHandler: PropTypes.bool,\n        mix: MixType,\n        disabled: PropTypes.bool\n    };\n\n    static defaultProps = {\n        quantity: 1,\n        configurableVariantIndex: 0,\n        setQuantityToDefault: () => {},\n        onProductValidationError: () => {},\n        isLoading: false,\n        disableHandler: false,\n        mix: {},\n        disabled: false\n    };\n\n    state = { isLoading: false };\n\n    validationMap = {\n        [CONFIGURABLE]: this.validateConfigurableProduct.bind(this),\n        [GROUPED]: this.validateGroupedProduct.bind(this),\n        [BUNDLE]: this.validateBundleProduct.bind(this)\n    };\n\n    addToCartHandlerMap = {\n        [CONFIGURABLE]: this.addConfigurableProductToCart.bind(this),\n        [GROUPED]: this.addGroupedProductToCart.bind(this)\n    };\n\n    containerFunctions = {\n        buttonClick: this.buttonClick.bind(this)\n    };\n\n    containerProps() {\n        const { product, mix, disabled } = this.props;\n        const { isLoading } = this.state;\n\n        return {\n            isLoading,\n            product,\n            mix,\n            disabled\n        };\n    }\n\n    validateConfigurableProduct() {\n        const {\n            configurableVariantIndex,\n            showNotification,\n            product: {\n                variants = []\n            }\n        } = this.props;\n\n        if (configurableVariantIndex < 0 || !variants[configurableVariantIndex]) {\n            showNotification('info', __('Please select product options!'));\n            return false;\n        }\n\n        const { stock_status: configurableStock } = variants[configurableVariantIndex];\n\n        if (configurableStock !== IN_STOCK) {\n            showNotification('info', __('Sorry! The selected product option is out of stock!'));\n            return false;\n        }\n\n        return true;\n    }\n\n    validateGroupedProduct() {\n        const {\n            groupedProductQuantity,\n            showNotification,\n            product: {\n                items = []\n            }\n        } = this.props;\n\n        const isAllItemsAvailable = items.some(({ product: { id } }) => groupedProductQuantity[id]);\n\n        if (!isAllItemsAvailable) {\n            showNotification('info', __('Please specify the quantity of product(s)!'));\n            return false;\n        }\n\n        return true;\n    }\n\n    validateBundleProduct() {\n        const {\n            productOptionsData,\n            showNotification\n        } = this.props;\n\n        const validateBundleOptions = this.validateCustomizableOptions(productOptionsData, true);\n\n        if (!validateBundleOptions) {\n            showNotification('info', __('Please select required option!'));\n            return false;\n        }\n\n        return true;\n    }\n\n    validateSimpleProduct() {\n        const {\n            productOptionsData,\n            showNotification\n        } = this.props;\n\n        const validateCustomizableOptions = this.validateCustomizableOptions(productOptionsData);\n\n        if (!validateCustomizableOptions) {\n            showNotification('info', __('Please select required option!'));\n            return false;\n        }\n\n        return true;\n    }\n\n    validateCustomizableOptions(productOptionsData, isBundle = false) {\n        const {\n            requiredOptions = {}\n        } = productOptionsData || {};\n\n        if (requiredOptions.length) {\n            const {\n                productOptions,\n                productOptionsMulti,\n                requiredOptions\n            } = productOptionsData;\n\n            return this.validateProductOptions(\n                [...productOptions || [], ...productOptionsMulti || []],\n                requiredOptions,\n                isBundle\n            );\n        }\n\n        return true;\n    }\n\n    validateProductOptions(items, requiredOptions, isBundle = false) {\n        // Make sure EVERY required option is FOUND in selected items\n        return requiredOptions.every((requiredOption) => (\n            items.find((item) => {\n                const { id, option_id } = item;\n                const matchWith = isBundle ? id : option_id;\n                return requiredOption === matchWith;\n            })\n        ));\n    }\n\n    validateAddToCart() {\n        const {\n            product: { type_id }\n        } = this.props;\n\n        const validationRule = this.validationMap[type_id];\n\n        if (validationRule) {\n            return validationRule();\n        }\n\n        return this.validateSimpleProduct();\n    }\n\n    addGroupedProductToCart() {\n        const {\n            product,\n            product: { items },\n            groupedProductQuantity,\n            addProduct\n        } = this.props;\n\n        Promise.all(items.map((item) => {\n            const { product: groupedProductItem } = item;\n\n            const newProduct = {\n                ...groupedProductItem,\n                parent: product\n            };\n\n            const quantity = groupedProductQuantity[groupedProductItem.id];\n\n            if (!quantity) {\n                return Promise.resolve();\n            }\n\n            return addProduct({\n                product: newProduct,\n                quantity\n            });\n        })).then(\n            /** @namespace Component/AddToCart/Container/addGroupedProductToCartPromiseAllThen */\n            () => this.afterAddToCart(),\n            /** @namespace Component/AddToCart/Container/addGroupedProductToCartPromiseAllCatch */\n            () => this.resetLoading()\n        );\n    }\n\n    addConfigurableProductToCart() {\n        const {\n            product,\n            quantity,\n            addProduct,\n            configurableVariantIndex,\n            productOptionsData\n        } = this.props;\n\n        addProduct({\n            product: {\n                ...product,\n                configurableVariantIndex\n            },\n            quantity,\n            productOptionsData\n        }).then(\n            /** @namespace Component/AddToCart/Container/addConfigurableProductToCartAddProductThen */\n            () => this.afterAddToCart(),\n            /** @namespace Component/AddToCart/Container/addConfigurableProductToCartAddProductCatch */\n            () => this.resetLoading()\n        );\n    }\n\n    addSimpleProductToCart() {\n        const {\n            product,\n            quantity,\n            addProduct,\n            productOptionsData\n        } = this.props;\n\n        addProduct({\n            product,\n            quantity,\n            productOptionsData\n        }).then(\n            /** @namespace Component/AddToCart/Container/addSimpleProductToCartAddProductThen */\n            () => this.afterAddToCart(),\n            /** @namespace Component/AddToCart/Container/addSimpleProductToCartAddProductCatch */\n            () => this.resetLoading()\n        );\n    }\n\n    addProductToCart() {\n        const {\n            product: { type_id }\n        } = this.props;\n\n        const addToCartHandler = this.addToCartHandlerMap[type_id];\n\n        if (addToCartHandler) {\n            addToCartHandler();\n            return;\n        }\n\n        this.addSimpleProductToCart();\n    }\n\n    buttonClick() {\n        const {\n            product: { type_id } = {},\n            onProductValidationError,\n            disableHandler\n        } = this.props;\n\n        if (disableHandler) {\n            return;\n        }\n\n        if (!this.validateAddToCart()) {\n            onProductValidationError(type_id);\n            return;\n        }\n\n        this.setState({ isLoading: true }, () => this.addProductToCart());\n    }\n\n    resetLoading() {\n        this.setState({ isLoading: false });\n    }\n\n    removeProductFromWishlist() {\n        const {\n            wishlistItems,\n            removeFromWishlist,\n            configurableVariantIndex,\n            product: { type_id, variants = {} } = {}\n        } = this.props;\n\n        if (type_id !== 'configurable') {\n            return;\n        }\n\n        const { sku } = variants[configurableVariantIndex];\n\n        const wishlistItemKey = Object.keys(wishlistItems)\n            .find((key) => {\n                const { wishlist: { sku: wSku } } = wishlistItems[key];\n                return wSku === sku;\n            });\n\n        if (!isSignedIn() || wishlistItemKey === undefined) {\n            return;\n        }\n\n        const { wishlist: { id: item_id } } = wishlistItems[wishlistItemKey];\n        removeFromWishlist({ item_id, sku, noMessage: true });\n    }\n\n    afterAddToCart() {\n        const {\n            showNotification,\n            setQuantityToDefault\n        } = this.props;\n\n        showNotification('success', __('Product added to cart!'));\n        setQuantityToDefault();\n\n        this.removeProductFromWishlist();\n        this.setState({ isLoading: false });\n    }\n\n    render() {\n        return (\n            <AddToCart\n              { ...this.containerProps() }\n              { ...this.containerFunctions }\n            />\n        );\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(AddToCartContainer);\n"]},"metadata":{},"sourceType":"module"}