{"ast":null,"code":"/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\n/* eslint-disable no-param-reassign */\nexport const TYPE_CUSTOM_URL = 0;\nexport const TYPE_CMS_PAGE = 1;\nexport const TYPE_CATEGORY = 2;\n/**\n * Given an array of menu items, returns a copy of the array, sorted by their parent ID, then by their sort order (position)\n *\n * @param unsortedItems an array of items to be sorted\n * @returns {array} the sorted array\n * #namespace Util/Menu/getSortedItems\n */\n\nexport const getSortedItems = Mosaic.middleware(function (unsortedItems) {\n  return Array.from(unsortedItems).sort(function ({\n    parent_id: PID,\n    position: P\n  }, {\n    parent_id: prevPID,\n    position: prevP\n  }) {\n    return PID - prevPID || P - prevP;\n  });\n}, \"Util/Menu/getSortedItems\");\n/** #namespace Util/Menu */\n// eslint-disable-next-line @scandipwa/scandipwa-guidelines/derived-class-names\n\nexport const Menu = Mosaic.middleware(class Menu_ extends Mosaic.Extensible() {\n  getMenuUrl({\n    url,\n    url_type,\n    category_id\n  }) {\n    switch (url_type) {\n      case TYPE_CATEGORY:\n        return {\n          pathname: url,\n          search: '',\n          state: {\n            category: category_id\n          }\n        };\n\n      case TYPE_CMS_PAGE:\n        return {\n          pathname: url,\n          search: '',\n          state: {\n            page: true\n          }\n        };\n\n      default:\n        return url;\n    }\n  }\n\n  getMenuData({\n    cms_page_identifier,\n    url,\n    url_type,\n    category_id,\n    ...item\n  }) {\n    return { ...item,\n      url: this.getMenuUrl({\n        url,\n        url_type,\n        category_id\n      }),\n      children: {}\n    };\n  }\n\n  setToValue(obj, path, value) {\n    // eslint-disable-next-line fp/no-let\n    let i;\n    path = path.split('.'); // eslint-disable-next-line fp/no-loops\n\n    for (i = 0; i < path.length - 1; i++) {\n      obj = obj[path[i]];\n    }\n\n    obj[path[i]] = value;\n  }\n\n  createItem(data) {\n    const {\n      parent_id,\n      item_id\n    } = data;\n\n    if (parent_id === 0) {\n      this.menuPositionReference[item_id] = [];\n      this.menu[item_id] = this.getMenuData(data);\n    } else if (this.menuPositionReference[parent_id] !== undefined) {\n      this.menuPositionReference[item_id] = [...this.menuPositionReference[parent_id], parent_id];\n      this.setToValue(this.menu, `${this.menuPositionReference[item_id].join('.children.')}.children.${item_id}`, this.getMenuData(data));\n    }\n  }\n\n  reduce({\n    items: unsortedItems\n  }) {\n    var _this = this;\n\n    this.menu = {};\n    this.menuPositionReference = {};\n    getSortedItems(unsortedItems).forEach(function (realMenuItem) {\n      _this.createItem(realMenuItem);\n    });\n    return this.menu;\n  }\n\n}, \"Util/Menu\");\nexport default new Menu();","map":{"version":3,"sources":["/home/arturs/scandiweb/extension/node_modules/@scandipwa/scandipwa/src/util/Menu/Menu.js"],"names":["TYPE_CUSTOM_URL","TYPE_CMS_PAGE","TYPE_CATEGORY","getSortedItems","unsortedItems","Array","from","sort","parent_id","PID","position","P","prevPID","prevP","getMenuUrl","url","url_type","category_id","pathname","search","state","category","page","getMenuData","cms_page_identifier","item","children","setToValue","obj","path","value","i","split","length","createItem","data","item_id","menuPositionReference","menu","undefined","join","reduce","items","forEach","realMenuItem","Menu"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\n/* eslint-disable no-param-reassign */\n\nexport const TYPE_CUSTOM_URL = 0;\nexport const TYPE_CMS_PAGE = 1;\nexport const TYPE_CATEGORY = 2;\n\n/**\n * Given an array of menu items, returns a copy of the array, sorted by their parent ID, then by their sort order (position)\n *\n * @param unsortedItems an array of items to be sorted\n * @returns {array} the sorted array\n * @namespace Util/Menu/getSortedItems\n */\nexport const getSortedItems = (unsortedItems) => Array.from(unsortedItems).sort((\n    { parent_id: PID, position: P },\n    { parent_id: prevPID, position: prevP }\n) => (PID - prevPID) || (P - prevP));\n\n/** @namespace Util/Menu */\n// eslint-disable-next-line @scandipwa/scandipwa-guidelines/derived-class-names\nexport class Menu {\n    getMenuUrl({ url, url_type, category_id }) {\n        switch (url_type) {\n        case TYPE_CATEGORY:\n            return {\n                pathname: url,\n                search: '',\n                state: { category: category_id }\n            };\n        case TYPE_CMS_PAGE:\n            return {\n                pathname: url,\n                search: '',\n                state: { page: true }\n            };\n        default:\n            return url;\n        }\n    }\n\n    getMenuData({\n        cms_page_identifier,\n        url,\n        url_type,\n        category_id,\n        ...item\n    }) {\n        return {\n            ...item,\n            url: this.getMenuUrl({ url, url_type, category_id }),\n            children: {}\n        };\n    }\n\n    setToValue(obj, path, value) {\n        // eslint-disable-next-line fp/no-let\n        let i;\n        path = path.split('.');\n        // eslint-disable-next-line fp/no-loops\n        for (i = 0; i < path.length - 1; i++) {\n            obj = obj[path[i]];\n        }\n        obj[path[i]] = value;\n    }\n\n    createItem(data) {\n        const { parent_id, item_id } = data;\n\n        if (parent_id === 0) {\n            this.menuPositionReference[item_id] = [];\n            this.menu[item_id] = this.getMenuData(data);\n        } else if (this.menuPositionReference[parent_id] !== undefined) {\n            this.menuPositionReference[item_id] = [\n                ...this.menuPositionReference[parent_id],\n                parent_id\n            ];\n\n            this.setToValue(\n                this.menu,\n                `${this.menuPositionReference[item_id].join('.children.')}.children.${item_id}`,\n                this.getMenuData(data)\n            );\n        }\n    }\n\n    reduce({ items: unsortedItems }) {\n        this.menu = {};\n        this.menuPositionReference = {};\n\n        getSortedItems(unsortedItems).forEach((realMenuItem) => {\n            this.createItem(realMenuItem);\n        });\n\n        return this.menu;\n    }\n}\n\nexport default new Menu();\n"]},"metadata":{},"sourceType":"module"}