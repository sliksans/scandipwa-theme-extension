{"ast":null,"code":"var _class,\n    _temp,\n    _jsxFileName = \"/home/arturs/scandiweb/extension/node_modules/@scandipwa/scandipwa/src/component/NewProducts/NewProducts.container.js\";\n\n/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\nimport ProductListQuery from \"/home/arturs/scandiweb/extension/src/query/ProductList.query\";\nimport { showNotification } from \"/home/arturs/scandiweb/extension/src/store/Notification/Notification.action\";\nimport { getIndexedProducts } from \"/home/arturs/scandiweb/extension/src/util/Product\";\nimport { prepareQuery } from \"/home/arturs/scandiweb/extension/src/util/Query\";\nimport { executeGet } from \"/home/arturs/scandiweb/extension/src/util/Request\";\nimport NewProducts from \"./NewProducts.component\";\n/** #namespace Component/NewProducts/Container/mapStateToProps */\n\nexport const mapStateToProps = Mosaic.middleware(function (state) {\n  return {\n    timezone: state.ConfigReducer.timezone\n  };\n}, \"Component/NewProducts/Container/mapStateToProps\");\n/** #namespace Component/NewProducts/Container/mapDispatchToProps */\n\nexport const mapDispatchToProps = Mosaic.middleware(function (dispatch) {\n  return {\n    showNotification: function (type, title, error) {\n      return dispatch(showNotification(type, title, error));\n    }\n  };\n}, \"Component/NewProducts/Container/mapDispatchToProps\");\n/** #namespace Component/NewProducts/Container */\n\nvar _checkBEM = require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;\n\nexport const NewProductsContainer = Mosaic.middleware((_temp = _class = class NewProductsContainer_ extends Mosaic.Extensible(PureComponent) {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      products: undefined,\n      siblingsHaveBrands: false,\n      siblingsHavePriceBadge: false,\n      siblingsHaveTierPrice: false,\n      siblingsHaveConfigurableOptions: false\n    };\n  }\n\n  componentDidMount() {\n    this.requestProducts();\n  }\n\n  componentDidUpdate(prevProps) {\n    const {\n      category,\n      productsCount,\n      cacheLifetime,\n      timezone\n    } = this.props;\n    const {\n      category: pCategory,\n      productsCount: pProductsCount,\n      cacheLifetime: pCacheLifetime,\n      timezone: pTimezone\n    } = prevProps;\n\n    if (category !== pCategory || timezone !== pTimezone || productsCount !== pProductsCount || cacheLifetime !== pCacheLifetime) {\n      this.requestProducts();\n    }\n  }\n\n  containerProps() {\n    var _this = this;\n\n    const {\n      siblingsHaveBrands,\n      siblingsHavePriceBadge,\n      siblingsHaveTierPrice,\n      siblingsHaveConfigurableOptions\n    } = this.state;\n    return {\n      productCardFunctions: {\n        setSiblingsHaveBrands: function () {\n          return _this.setState({\n            siblingsHaveBrands: true\n          });\n        },\n        setSiblingsHavePriceBadge: function () {\n          return _this.setState({\n            siblingsHavePriceBadge: true\n          });\n        },\n        setSiblingsHaveTierPrice: function () {\n          return _this.setState({\n            siblingsHaveTierPrice: true\n          });\n        },\n        setSiblingsHaveConfigurableOptions: function () {\n          return _this.setState({\n            siblingsHaveConfigurableOptions: true\n          });\n        }\n      },\n      productCardProps: {\n        siblingsHaveBrands,\n        siblingsHavePriceBadge,\n        siblingsHaveTierPrice,\n        siblingsHaveConfigurableOptions\n      }\n    };\n  }\n  /**\n   * Calculates date for request in server locale and with ttl error\n   *\n   * @returns {Date}\n   * @memberof NewProducts\n   */\n\n\n  getRequestDate() {\n    const {\n      cacheLifetime,\n      timezone: timeZone\n    } = this.props;\n    const milliInSeccond = 1000;\n    const now = new Date();\n    const serverNow = new Date(now.toLocaleString('en', {\n      timeZone\n    }));\n    const serverNowTime = serverNow.getTime();\n    const ttl = cacheLifetime * milliInSeccond;\n    const requestTime = serverNowTime - serverNowTime % ttl;\n    const requestDate = new Date(requestTime);\n    const timeOffset = 10;\n    return requestDate.toISOString().slice(0, timeOffset);\n  }\n\n  requestProducts() {\n    var _this2 = this;\n\n    const {\n      timezone,\n      category: categoryUrlPath,\n      productsCount: pageSize,\n      cacheLifetime,\n      showNotification\n    } = this.props;\n\n    if (!timezone) {\n      return;\n    }\n\n    const newToDate = this.getRequestDate();\n    const options = {\n      args: {\n        filter: {\n          categoryUrlPath,\n          newToDate\n        },\n        currentPage: 1,\n        pageSize\n      }\n    };\n    const query = [ProductListQuery.getQuery(options)];\n    executeGet(prepareQuery(query), 'NewProducts', cacheLifetime).then(\n    /** #namespace Component/NewProducts/Container/executeGetThen */\n    Mosaic.middleware(function ({\n      products: {\n        items\n      }\n    }) {\n      return _this2.setState({\n        products: getIndexedProducts(items)\n      });\n    }, \"Component/NewProducts/Container/executeGetThen\")).catch(\n    /** #namespace Component/NewProducts/Container/executeGetThenCatch */\n    Mosaic.middleware(function (e) {\n      return showNotification('error', __('Error fetching NewProducts!'), e);\n    }, \"Component/NewProducts/Container/executeGetThenCatch\"));\n  }\n\n  render() {\n    return /*#__PURE__*/_checkBEM(React, NewProducts, Object.assign({}, this.props, this.state, this.containerProps(), {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 13\n      }\n    }));\n  }\n\n}, _class.propTypes = {\n  category: PropTypes.string,\n  cacheLifetime: PropTypes.number,\n  productsCount: PropTypes.number,\n  timezone: PropTypes.string.isRequired,\n  showNotification: PropTypes.func.isRequired\n}, _class.defaultProps = {\n  category: '',\n  productsCount: 10,\n  cacheLifetime: 86400\n}, _temp), \"Component/NewProducts/Container\");\nexport default connect(mapStateToProps, mapDispatchToProps)(NewProductsContainer);","map":{"version":3,"sources":["/home/arturs/scandiweb/extension/node_modules/@scandipwa/scandipwa/src/component/NewProducts/NewProducts.container.js"],"names":["PropTypes","PureComponent","connect","ProductListQuery","showNotification","getIndexedProducts","prepareQuery","executeGet","NewProducts","mapStateToProps","state","timezone","ConfigReducer","mapDispatchToProps","dispatch","type","title","error","products","undefined","siblingsHaveBrands","siblingsHavePriceBadge","siblingsHaveTierPrice","siblingsHaveConfigurableOptions","componentDidMount","requestProducts","componentDidUpdate","prevProps","category","productsCount","cacheLifetime","props","pCategory","pProductsCount","pCacheLifetime","pTimezone","containerProps","productCardFunctions","setSiblingsHaveBrands","setState","setSiblingsHavePriceBadge","setSiblingsHaveTierPrice","setSiblingsHaveConfigurableOptions","productCardProps","getRequestDate","timeZone","milliInSeccond","now","Date","serverNow","toLocaleString","serverNowTime","getTime","ttl","requestTime","requestDate","timeOffset","toISOString","slice","categoryUrlPath","pageSize","newToDate","options","args","filter","currentPage","query","getQuery","then","items","catch","e","__","render","propTypes","string","number","isRequired","func","defaultProps","NewProductsContainer"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport { connect } from 'react-redux';\n\nimport ProductListQuery from 'Query/ProductList.query';\nimport { showNotification } from 'Store/Notification/Notification.action';\nimport { getIndexedProducts } from 'Util/Product';\nimport { prepareQuery } from 'Util/Query';\nimport { executeGet } from 'Util/Request';\n\nimport NewProducts from './NewProducts.component';\n\n/** @namespace Component/NewProducts/Container/mapStateToProps */\nexport const mapStateToProps = (state) => ({\n    timezone: state.ConfigReducer.timezone\n});\n\n/** @namespace Component/NewProducts/Container/mapDispatchToProps */\nexport const mapDispatchToProps = (dispatch) => ({\n    showNotification: (type, title, error) => dispatch(showNotification(type, title, error))\n});\n\n/** @namespace Component/NewProducts/Container */\nexport class NewProductsContainer extends PureComponent {\n    static propTypes = {\n        category: PropTypes.string,\n        cacheLifetime: PropTypes.number,\n        productsCount: PropTypes.number,\n        timezone: PropTypes.string.isRequired,\n        showNotification: PropTypes.func.isRequired\n    };\n\n    static defaultProps = {\n        category: '',\n        productsCount: 10,\n        cacheLifetime: 86400\n    };\n\n    state = {\n        products: undefined,\n        siblingsHaveBrands: false,\n        siblingsHavePriceBadge: false,\n        siblingsHaveTierPrice: false,\n        siblingsHaveConfigurableOptions: false\n    };\n\n    componentDidMount() {\n        this.requestProducts();\n    }\n\n    componentDidUpdate(prevProps) {\n        const {\n            category,\n            productsCount,\n            cacheLifetime,\n            timezone\n        } = this.props;\n        const {\n            category: pCategory,\n            productsCount: pProductsCount,\n            cacheLifetime: pCacheLifetime,\n            timezone: pTimezone\n        } = prevProps;\n\n        if (category !== pCategory\n            || timezone !== pTimezone\n            || productsCount !== pProductsCount\n            || cacheLifetime !== pCacheLifetime) {\n            this.requestProducts();\n        }\n    }\n\n    containerProps() {\n        const {\n            siblingsHaveBrands,\n            siblingsHavePriceBadge,\n            siblingsHaveTierPrice,\n            siblingsHaveConfigurableOptions\n        } = this.state;\n\n        return {\n            productCardFunctions: {\n                setSiblingsHaveBrands: () => this.setState({ siblingsHaveBrands: true }),\n                setSiblingsHavePriceBadge: () => this.setState({ siblingsHavePriceBadge: true }),\n                setSiblingsHaveTierPrice: () => this.setState({ siblingsHaveTierPrice: true }),\n                setSiblingsHaveConfigurableOptions: () => this.setState({ siblingsHaveConfigurableOptions: true })\n            },\n            productCardProps: {\n                siblingsHaveBrands,\n                siblingsHavePriceBadge,\n                siblingsHaveTierPrice,\n                siblingsHaveConfigurableOptions\n            }\n        };\n    }\n\n    /**\n     * Calculates date for request in server locale and with ttl error\n     *\n     * @returns {Date}\n     * @memberof NewProducts\n     */\n    getRequestDate() {\n        const { cacheLifetime, timezone: timeZone } = this.props;\n        const milliInSeccond = 1000;\n\n        const now = new Date();\n        const serverNow = new Date(now.toLocaleString('en', { timeZone }));\n\n        const serverNowTime = serverNow.getTime();\n        const ttl = cacheLifetime * milliInSeccond;\n\n        const requestTime = serverNowTime - (serverNowTime % ttl);\n        const requestDate = new Date(requestTime);\n\n        const timeOffset = 10;\n        return requestDate.toISOString().slice(0, timeOffset);\n    }\n\n    requestProducts() {\n        const {\n            timezone,\n            category: categoryUrlPath,\n            productsCount: pageSize,\n            cacheLifetime,\n            showNotification\n        } = this.props;\n\n        if (!timezone) {\n            return;\n        }\n\n        const newToDate = this.getRequestDate();\n\n        const options = {\n            args: {\n                filter: {\n                    categoryUrlPath,\n                    newToDate\n                },\n                currentPage: 1,\n                pageSize\n            }\n        };\n\n        const query = [ProductListQuery.getQuery(options)];\n        executeGet(prepareQuery(query), 'NewProducts', cacheLifetime)\n            .then(\n                /** @namespace Component/NewProducts/Container/executeGetThen */\n                ({ products: { items } }) => this.setState({ products: getIndexedProducts(items) })\n            )\n            .catch(\n                /** @namespace Component/NewProducts/Container/executeGetThenCatch */\n                (e) => showNotification('error', __('Error fetching NewProducts!'), e)\n            );\n    }\n\n    render() {\n        return (\n            <NewProducts\n              { ...this.props }\n              { ...this.state }\n              { ...this.containerProps() }\n            />\n        );\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(NewProductsContainer);\n"]},"metadata":{},"sourceType":"module"}