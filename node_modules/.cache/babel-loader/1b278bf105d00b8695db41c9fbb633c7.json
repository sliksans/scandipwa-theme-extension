{"ast":null,"code":"var _class,\n    _temp,\n    _jsxFileName = \"/home/arturs/scandiweb/extension/node_modules/@scandipwa/scandipwa/src/component/ProductGallery/ProductGallery.component.js\";\n\n/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\nimport PropTypes from 'prop-types';\nimport { createRef, PureComponent } from 'react';\nimport { withRouter } from 'react-router';\nimport { TransformWrapper } from 'react-zoom-pan-pinch';\nimport CarouselScroll from \"/home/arturs/scandiweb/extension/src/component/CarouselScroll\";\nimport Image from \"/home/arturs/scandiweb/extension/src/component/Image\";\nimport ProductGalleryBaseImage from \"/home/arturs/scandiweb/extension/src/component/ProductGalleryBaseImage\";\nimport ProductGalleryThumbnailImage from \"/home/arturs/scandiweb/extension/src/component/ProductGalleryThumbnailImage\";\nimport Slider from \"/home/arturs/scandiweb/extension/src/component/Slider\";\nimport VideoPopup from \"/home/arturs/scandiweb/extension/src/component/VideoPopup\";\nimport VideoThumbnail from \"/home/arturs/scandiweb/extension/src/component/VideoThumbnail\";\nimport { LocationType } from \"/home/arturs/scandiweb/extension/src/type/Common\";\nimport CSS from \"/home/arturs/scandiweb/extension/src/util/CSS\";\nimport { IMAGE_TYPE, MAX_ZOOM_SCALE, PLACEHOLDER_TYPE, VIDEO_TYPE } from \"./ProductGallery.config\";\nimport \"./ProductGallery.style\";\n/**\n * Product gallery\n * @class ProductGallery\n * #namespace Component/ProductGallery/Component\n */\n\nvar _checkBEM = require(\"babel-plugin-transform-rebem-jsx\").checkBEMProps;\n\nexport const ProductGallery = Mosaic.middleware((_temp = _class = class ProductGallery_ extends Mosaic.Extensible(PureComponent) {\n  constructor(...args) {\n    var _this;\n\n    super(...args);\n    _this = this;\n    this.maxScale = MAX_ZOOM_SCALE;\n    this.imageRef = /*#__PURE__*/createRef();\n    this.state = {\n      scrollEnabled: true\n    };\n\n    this.handleSliderClick = function () {\n      const {\n        handleImageZoomPopupActiveChange,\n        gallery,\n        activeImage\n      } = _this.props;\n      const {\n        media_type\n      } = gallery[activeImage];\n\n      if (media_type === VIDEO_TYPE) {\n        return;\n      }\n\n      handleImageZoomPopupActiveChange(true);\n    };\n\n    this.renderAdditionalPicture = function (media, index = 0) {\n      return /*#__PURE__*/_checkBEM(React, ProductGalleryThumbnailImage, {\n        key: index,\n        media: media,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 9\n        }\n      });\n    };\n\n    this.onWheel = function (zoomState) {\n      const {\n        scale\n      } = zoomState;\n\n      if (_this.timeout) {\n        return;\n      }\n\n      if (scale === 1 || scale === MAX_ZOOM_SCALE) {\n        _this.stopScrolling();\n      }\n    };\n  }\n\n  __construct(props, context) {\n    super.__construct(props, context);\n\n    this.renderSlide = this.renderSlide.bind(this);\n  }\n\n  componentDidMount() {\n    this.updateSharedDestinationElement();\n  }\n\n  componentDidUpdate(prevProps) {\n    var _sliderRef$current;\n\n    const {\n      productId,\n      location: {\n        pathname\n      },\n      sliderRef\n    } = this.props;\n    const {\n      productId: prevProductId,\n      location: {\n        pathname: prevPathname\n      }\n    } = prevProps;\n\n    if (productId !== prevProductId) {\n      this.updateSharedDestinationElement();\n    }\n\n    if ((sliderRef === null || sliderRef === void 0 ? void 0 : (_sliderRef$current = sliderRef.current) === null || _sliderRef$current === void 0 ? void 0 : _sliderRef$current.draggableRef) && pathname !== prevPathname) {\n      CSS.setVariable(sliderRef.current.draggableRef, 'animation-speed', 0);\n    }\n  }\n\n  updateSharedDestinationElement() {\n    const {\n      registerSharedElementDestination\n    } = this.props;\n    registerSharedElementDestination(this.imageRef);\n  }\n\n  /**\n   * Renders a video thumbnail which opens popup player on click/tap\n   * @param media\n   * @param index\n   * @returns {*}\n   * @private\n   */\n  renderVideo(media, index) {\n    const {\n      isImageZoomPopupActive\n    } = this.props;\n    return /*#__PURE__*/_checkBEM(React, VideoThumbnail, {\n      key: index,\n      media: media,\n      isVideoZoomed: isImageZoomPopupActive,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 13\n      }\n    });\n  }\n\n  renderPlaceholder(index) {\n    return /*#__PURE__*/_checkBEM(React, Image, {\n      key: index,\n      ratio: \"custom\",\n      mix: {\n        block: 'ProductGallery',\n        elem: 'SliderImage',\n        mods: {\n          isPlaceholder: true\n        }\n      },\n      isPlaceholder: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 13\n      }\n    });\n  }\n\n  stopScrolling() {\n    var _this2 = this;\n\n    this.setState({\n      scrollEnabled: false\n    });\n    this.timeout = setTimeout(function () {\n      _this2.setState({\n        scrollEnabled: true\n      });\n\n      _this2.timeout = null; // 20 ms is time give to scroll down, usually that is enough\n      // eslint-disable-next-line no-magic-numbers\n    }, 20);\n  }\n\n  /**\n   * Renders a product image to be displayed in the gallery\n   * @param mediaData\n   * @param index\n   * @returns {*}\n   * @private\n   */\n  renderImage(mediaData, index) {\n    var _this3 = this;\n\n    const {\n      isZoomEnabled,\n      handleZoomChange,\n      disableZoom,\n      isMobile,\n      isImageZoomPopupActive\n    } = this.props;\n    const {\n      scrollEnabled\n    } = this.state;\n\n    if (!isMobile) {\n      const {\n        base: {\n          url: baseSrc\n        } = {},\n        large: {\n          url: largeSrc\n        } = {}\n      } = mediaData;\n      const style = isImageZoomPopupActive ? {\n        height: 'auto'\n      } : {};\n      const src = isImageZoomPopupActive ? largeSrc : baseSrc;\n      return /*#__PURE__*/_checkBEM(React, Image, {\n        key: index,\n        src: src,\n        ratio: \"custom\",\n        mix: {\n          block: 'ProductGallery',\n          elem: 'SliderImage',\n          mods: {\n            isPlaceholder: !src\n          }\n        },\n        isPlaceholder: !src,\n        style: style,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 218,\n          columnNumber: 17\n        }\n      });\n    }\n\n    return /*#__PURE__*/_checkBEM(React, TransformWrapper, {\n      key: index,\n      onZoomChange: handleZoomChange,\n      onWheelStart: this.onWheelStart,\n      onWheel: this.onWheel,\n      wheel: {\n        limitsOnWheel: true,\n        disabled: !scrollEnabled\n      } //   doubleClick={ { mode: 'reset' } }\n      ,\n      pan: {\n        disabled: !isZoomEnabled,\n        limitToWrapperBounds: true,\n        velocity: false\n      },\n      options: {\n        limitToBounds: true,\n        minScale: 1\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 13\n      }\n    }, function ({\n      scale,\n      previousScale,\n      resetTransform,\n      setTransform\n    }) {\n      if (scale === 1 && previousScale !== 1) {\n        resetTransform();\n      }\n\n      return /*#__PURE__*/_checkBEM(React, ProductGalleryBaseImage, {\n        setTransform: setTransform,\n        index: index,\n        mediaData: mediaData,\n        scale: scale,\n        previousScale: previousScale,\n        disableZoom: disableZoom,\n        isZoomEnabled: isZoomEnabled,\n        __self: _this3,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 262,\n          columnNumber: 25\n        }\n      });\n    });\n  }\n  /**\n   * Checks for the type of the slide and renders it accordingly\n   * @param media\n   * @param index\n   * @returns {null|*}\n   */\n\n\n  renderSlide(media, index) {\n    const {\n      media_type\n    } = media;\n\n    switch (media_type) {\n      case IMAGE_TYPE:\n        return this.renderImage(media, index);\n\n      case VIDEO_TYPE:\n        return this.renderVideo(media, index);\n\n      case PLACEHOLDER_TYPE:\n        return this.renderPlaceholder(index);\n\n      default:\n        return null;\n    }\n  }\n\n  renderAdditionalPictures() {\n    const {\n      gallery,\n      isImageZoomPopupActive,\n      activeImage,\n      onActiveImageChange\n    } = this.props;\n\n    if (gallery.length === 1) {\n      return /*#__PURE__*/_checkBEM(React, \"div\", {\n        block: \"ProductGallery\",\n        elem: \"Additional\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 307,\n          columnNumber: 20\n        }\n      });\n    }\n\n    return /*#__PURE__*/_checkBEM(React, \"div\", {\n      block: \"ProductGallery\",\n      elem: \"Additional\",\n      mods: {\n        isImageZoomPopupActive\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 311,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/_checkBEM(React, CarouselScroll, {\n      activeItemId: activeImage,\n      onChange: onActiveImageChange,\n      showedItemCount: 4,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 312,\n        columnNumber: 17\n      }\n    }, gallery.map(this.renderAdditionalPicture)));\n  }\n\n  getImageUrl() {\n    const {\n      gallery: [{\n        thumbnail: {\n          url = ''\n        } = {}\n      }] = []\n    } = this.props;\n    return url;\n  }\n\n  renderSlider() {\n    const {\n      gallery,\n      activeImage,\n      isZoomEnabled,\n      onActiveImageChange,\n      isImageZoomPopupActive,\n      sliderRef\n    } = this.props;\n    const mods = {\n      isImageZoomPopupActive,\n      isZoomInCursor: !isImageZoomPopupActive\n    };\n    return /*#__PURE__*/_checkBEM(React, \"div\", {\n      ref: this.imageRef,\n      block: \"ProductGallery\",\n      elem: \"SliderWrapper\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 349,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/_checkBEM(React, \"meta\", {\n      itemProp: \"image\",\n      content: this.getImageUrl(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 354,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/_checkBEM(React, Slider, {\n      sliderRef: sliderRef,\n      mix: {\n        block: 'ProductGallery',\n        elem: 'Slider',\n        mods\n      },\n      showCrumbs: true,\n      activeImage: activeImage,\n      onActiveImageChange: onActiveImageChange,\n      isInteractionDisabled: isZoomEnabled,\n      onClick: this.handleSliderClick,\n      sliderHeight: isImageZoomPopupActive ? '100%' : 0,\n      isHeightTransitionDisabledOnMount: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 355,\n        columnNumber: 17\n      }\n    }, gallery.map(this.renderSlide)));\n  }\n\n  render() {\n    return /*#__PURE__*/_checkBEM(React, \"div\", {\n      block: \"ProductGallery\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 374,\n        columnNumber: 13\n      }\n    }, this.renderAdditionalPictures(), this.renderSlider(), /*#__PURE__*/_checkBEM(React, VideoPopup, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 377,\n        columnNumber: 17\n      }\n    }));\n  }\n\n}, _class.propTypes = {\n  gallery: PropTypes.arrayOf(PropTypes.shape({\n    id: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n    image: PropTypes.string,\n    isPlaceholder: PropTypes.bool,\n    alt: PropTypes.string,\n    type: PropTypes.string,\n    media_type: PropTypes.string\n  })).isRequired,\n  productId: PropTypes.number,\n  isZoomEnabled: PropTypes.bool.isRequired,\n  activeImage: PropTypes.number.isRequired,\n  onActiveImageChange: PropTypes.func.isRequired,\n  handleZoomChange: PropTypes.func.isRequired,\n  registerSharedElementDestination: PropTypes.func.isRequired,\n  disableZoom: PropTypes.func.isRequired,\n  location: LocationType.isRequired,\n  sliderRef: PropTypes.object.isRequired,\n  handleImageZoomPopupActiveChange: PropTypes.func.isRequired,\n  isMobile: PropTypes.bool.isRequired,\n  isImageZoomPopupActive: PropTypes.bool.isRequired\n}, _class.defaultProps = {\n  productId: 0\n}, _temp), \"Component/ProductGallery/Component\");\nexport default _c = withRouter(ProductGallery);\n\nvar _c;\n\n$RefreshReg$(_c, \"%default%\");","map":{"version":3,"sources":["/home/arturs/scandiweb/extension/node_modules/@scandipwa/scandipwa/src/component/ProductGallery/ProductGallery.component.js"],"names":["PropTypes","createRef","PureComponent","withRouter","TransformWrapper","CarouselScroll","Image","ProductGalleryBaseImage","ProductGalleryThumbnailImage","Slider","VideoPopup","VideoThumbnail","LocationType","CSS","IMAGE_TYPE","MAX_ZOOM_SCALE","PLACEHOLDER_TYPE","VIDEO_TYPE","maxScale","imageRef","state","scrollEnabled","handleSliderClick","handleImageZoomPopupActiveChange","gallery","activeImage","props","media_type","renderAdditionalPicture","media","index","onWheel","zoomState","scale","timeout","stopScrolling","__construct","context","renderSlide","bind","componentDidMount","updateSharedDestinationElement","componentDidUpdate","prevProps","productId","location","pathname","sliderRef","prevProductId","prevPathname","current","draggableRef","setVariable","registerSharedElementDestination","renderVideo","isImageZoomPopupActive","renderPlaceholder","block","elem","mods","isPlaceholder","setState","setTimeout","renderImage","mediaData","isZoomEnabled","handleZoomChange","disableZoom","isMobile","base","url","baseSrc","large","largeSrc","style","height","src","onWheelStart","limitsOnWheel","disabled","limitToWrapperBounds","velocity","limitToBounds","minScale","previousScale","resetTransform","setTransform","renderAdditionalPictures","onActiveImageChange","length","map","getImageUrl","thumbnail","renderSlider","isZoomInCursor","render","propTypes","arrayOf","shape","id","oneOfType","number","string","image","bool","alt","type","isRequired","func","object","defaultProps","ProductGallery"],"mappings":"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","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport PropTypes from 'prop-types';\nimport { createRef, PureComponent } from 'react';\nimport { withRouter } from 'react-router';\nimport { TransformWrapper } from 'react-zoom-pan-pinch';\n\nimport CarouselScroll from 'Component/CarouselScroll';\nimport Image from 'Component/Image';\nimport ProductGalleryBaseImage from 'Component/ProductGalleryBaseImage';\nimport ProductGalleryThumbnailImage from 'Component/ProductGalleryThumbnailImage';\nimport Slider from 'Component/Slider';\nimport VideoPopup from 'Component/VideoPopup';\nimport VideoThumbnail from 'Component/VideoThumbnail';\nimport { LocationType } from 'Type/Common';\nimport CSS from 'Util/CSS';\n\nimport {\n    IMAGE_TYPE,\n    MAX_ZOOM_SCALE,\n    PLACEHOLDER_TYPE,\n    VIDEO_TYPE\n} from './ProductGallery.config';\n\nimport './ProductGallery.style';\n\n/**\n * Product gallery\n * @class ProductGallery\n * @namespace Component/ProductGallery/Component\n */\nexport class ProductGallery extends PureComponent {\n    static propTypes = {\n        gallery: PropTypes.arrayOf(\n            PropTypes.shape({\n                id: PropTypes.oneOfType([\n                    PropTypes.number,\n                    PropTypes.string\n                ]),\n                image: PropTypes.string,\n                isPlaceholder: PropTypes.bool,\n                alt: PropTypes.string,\n                type: PropTypes.string,\n                media_type: PropTypes.string\n            })\n        ).isRequired,\n        productId: PropTypes.number,\n        isZoomEnabled: PropTypes.bool.isRequired,\n        activeImage: PropTypes.number.isRequired,\n        onActiveImageChange: PropTypes.func.isRequired,\n        handleZoomChange: PropTypes.func.isRequired,\n        registerSharedElementDestination: PropTypes.func.isRequired,\n        disableZoom: PropTypes.func.isRequired,\n        location: LocationType.isRequired,\n        sliderRef: PropTypes.object.isRequired,\n        handleImageZoomPopupActiveChange: PropTypes.func.isRequired,\n        isMobile: PropTypes.bool.isRequired,\n        isImageZoomPopupActive: PropTypes.bool.isRequired\n    };\n\n    static defaultProps = {\n        productId: 0\n    };\n\n    maxScale = MAX_ZOOM_SCALE;\n\n    imageRef = createRef();\n\n    state = {\n        scrollEnabled: true\n    };\n\n    __construct(props, context) {\n        super.__construct(props, context);\n        this.renderSlide = this.renderSlide.bind(this);\n    }\n\n    componentDidMount() {\n        this.updateSharedDestinationElement();\n    }\n\n    componentDidUpdate(prevProps) {\n        const { productId, location: { pathname }, sliderRef } = this.props;\n        const { productId: prevProductId, location: { pathname: prevPathname } } = prevProps;\n\n        if (productId !== prevProductId) {\n            this.updateSharedDestinationElement();\n        }\n\n        if (sliderRef?.current?.draggableRef && pathname !== prevPathname) {\n            CSS.setVariable(\n                sliderRef.current.draggableRef,\n                'animation-speed',\n                0\n            );\n        }\n    }\n\n    handleSliderClick = () => {\n        const {\n            handleImageZoomPopupActiveChange,\n            gallery,\n            activeImage\n        } = this.props;\n\n        const { media_type } = gallery[activeImage];\n        if (media_type === VIDEO_TYPE) {\n            return;\n        }\n\n        handleImageZoomPopupActiveChange(true);\n    };\n\n    updateSharedDestinationElement() {\n        const { registerSharedElementDestination } = this.props;\n        registerSharedElementDestination(this.imageRef);\n    }\n\n    renderAdditionalPicture = (media, index = 0) => (\n        <ProductGalleryThumbnailImage\n          key={ index }\n          media={ media }\n        />\n    );\n\n    /**\n     * Renders a video thumbnail which opens popup player on click/tap\n     * @param media\n     * @param index\n     * @returns {*}\n     * @private\n     */\n    renderVideo(media, index) {\n        const { isImageZoomPopupActive } = this.props;\n        return (\n            <VideoThumbnail\n              key={ index }\n              media={ media }\n              isVideoZoomed={ isImageZoomPopupActive }\n            />\n        );\n    }\n\n    renderPlaceholder(index) {\n        return (\n            <Image\n              key={ index }\n              ratio=\"custom\"\n              mix={ {\n                  block: 'ProductGallery',\n                  elem: 'SliderImage',\n                  mods: { isPlaceholder: true }\n              } }\n              isPlaceholder\n            />\n        );\n    }\n\n    stopScrolling() {\n        this.setState({ scrollEnabled: false });\n        this.timeout = setTimeout(() => {\n            this.setState({ scrollEnabled: true });\n            this.timeout = null;\n\n            // 20 ms is time give to scroll down, usually that is enough\n            // eslint-disable-next-line no-magic-numbers\n        }, 20);\n    }\n\n    onWheel = (zoomState) => {\n        const { scale } = zoomState;\n\n        if (this.timeout) {\n            return;\n        }\n\n        if (scale === 1 || scale === MAX_ZOOM_SCALE) {\n            this.stopScrolling();\n        }\n    };\n\n    /**\n     * Renders a product image to be displayed in the gallery\n     * @param mediaData\n     * @param index\n     * @returns {*}\n     * @private\n     */\n    renderImage(mediaData, index) {\n        const {\n            isZoomEnabled,\n            handleZoomChange,\n            disableZoom,\n            isMobile,\n            isImageZoomPopupActive\n        } = this.props;\n        const { scrollEnabled } = this.state;\n\n        if (!isMobile) {\n            const {\n                base: { url: baseSrc } = {},\n                large: { url: largeSrc } = {}\n            } = mediaData;\n\n            const style = isImageZoomPopupActive ? { height: 'auto' } : {};\n            const src = isImageZoomPopupActive ? largeSrc : baseSrc;\n\n            return (\n                <Image\n                  key={ index }\n                  src={ src }\n                  ratio=\"custom\"\n                  mix={ {\n                      block: 'ProductGallery',\n                      elem: 'SliderImage',\n                      mods: { isPlaceholder: !src }\n                  } }\n                  isPlaceholder={ !src }\n                  style={ style }\n                />\n            );\n        }\n\n        return (\n            <TransformWrapper\n              key={ index }\n              onZoomChange={ handleZoomChange }\n              onWheelStart={ this.onWheelStart }\n              onWheel={ this.onWheel }\n              wheel={ { limitsOnWheel: true, disabled: !scrollEnabled } }\n            //   doubleClick={ { mode: 'reset' } }\n              pan={ {\n                  disabled: !isZoomEnabled,\n                  limitToWrapperBounds: true,\n                  velocity: false\n              } }\n              options={ {\n                  limitToBounds: true,\n                  minScale: 1\n              } }\n            >\n                { ({\n                    scale,\n                    previousScale,\n                    resetTransform,\n                    setTransform\n                }) => {\n                    if (scale === 1 && previousScale !== 1) {\n                        resetTransform();\n                    }\n\n                    return (\n                        <ProductGalleryBaseImage\n                          setTransform={ setTransform }\n                          index={ index }\n                          mediaData={ mediaData }\n                          scale={ scale }\n                          previousScale={ previousScale }\n                          disableZoom={ disableZoom }\n                          isZoomEnabled={ isZoomEnabled }\n                        />\n                    );\n                } }\n            </TransformWrapper>\n        );\n    }\n\n    /**\n     * Checks for the type of the slide and renders it accordingly\n     * @param media\n     * @param index\n     * @returns {null|*}\n     */\n    renderSlide(media, index) {\n        const { media_type } = media;\n\n        switch (media_type) {\n        case IMAGE_TYPE:\n            return this.renderImage(media, index);\n        case VIDEO_TYPE:\n            return this.renderVideo(media, index);\n        case PLACEHOLDER_TYPE:\n            return this.renderPlaceholder(index);\n        default:\n            return null;\n        }\n    }\n\n    renderAdditionalPictures() {\n        const {\n            gallery,\n            isImageZoomPopupActive,\n            activeImage,\n            onActiveImageChange\n        } = this.props;\n\n        if (gallery.length === 1) {\n            return <div block=\"ProductGallery\" elem=\"Additional\" />;\n        }\n\n        return (\n            <div block=\"ProductGallery\" elem=\"Additional\" mods={ { isImageZoomPopupActive } }>\n                <CarouselScroll activeItemId={ activeImage } onChange={ onActiveImageChange } showedItemCount={ 4 }>\n                    { gallery.map(this.renderAdditionalPicture) }\n                </CarouselScroll>\n            </div>\n        );\n    }\n\n    getImageUrl() {\n        const {\n            gallery: [\n                {\n                    thumbnail: {\n                        url = ''\n                    } = {}\n                }\n            ] = []\n        } = this.props;\n\n        return url;\n    }\n\n    renderSlider() {\n        const {\n            gallery,\n            activeImage,\n            isZoomEnabled,\n            onActiveImageChange,\n            isImageZoomPopupActive,\n            sliderRef\n        } = this.props;\n\n        const mods = {\n            isImageZoomPopupActive,\n            isZoomInCursor: !isImageZoomPopupActive\n        };\n\n        return (\n            <div\n              ref={ this.imageRef }\n              block=\"ProductGallery\"\n              elem=\"SliderWrapper\"\n            >\n                <meta itemProp=\"image\" content={ this.getImageUrl() } />\n                <Slider\n                  sliderRef={ sliderRef }\n                  mix={ { block: 'ProductGallery', elem: 'Slider', mods } }\n                  showCrumbs\n                  activeImage={ activeImage }\n                  onActiveImageChange={ onActiveImageChange }\n                  isInteractionDisabled={ isZoomEnabled }\n                  onClick={ this.handleSliderClick }\n                  sliderHeight={ isImageZoomPopupActive ? '100%' : 0 }\n                  isHeightTransitionDisabledOnMount\n                >\n                    { gallery.map(this.renderSlide) }\n                </Slider>\n            </div>\n        );\n    }\n\n    render() {\n        return (\n            <div block=\"ProductGallery\">\n                { this.renderAdditionalPictures() }\n                { this.renderSlider() }\n                <VideoPopup />\n            </div>\n        );\n    }\n}\n\nexport default withRouter(ProductGallery);\n"]},"metadata":{},"sourceType":"module"}