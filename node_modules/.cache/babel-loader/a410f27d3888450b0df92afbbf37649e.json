{"ast":null,"code":"/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\nimport ProductListQuery from \"/home/arturs/scandiweb/extension/src/query/ProductList.query\";\nimport { updateNoMatch } from \"/home/arturs/scandiweb/extension/src/store/NoMatch/NoMatch.action\";\nimport { updateProductDetails } from \"/home/arturs/scandiweb/extension/src/store/Product/Product.action\";\nimport { QueryDispatcher } from \"/home/arturs/scandiweb/extension/src/util/Request\";\nexport const LinkedProductsDispatcher = import(\n/* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n\"/home/arturs/scandiweb/extension/src/store/LinkedProducts/LinkedProducts.dispatcher\");\n/**\n * Product List Dispatcher\n * @class ProductDispatcher\n * @extends ProductDispatcher\n * #namespace Store/Product/Dispatcher\n */\n\nexport const ProductDispatcher = Mosaic.middleware(class ProductDispatcher_ extends Mosaic.Extensible(QueryDispatcher) {\n  __construct() {\n    super.__construct('Product');\n  }\n\n  onSuccess(data, dispatch) {\n    const {\n      products: {\n        items\n      }\n    } = data;\n    /**\n     * In case there are no items, or item count is\n     * smaller then 0 => the product was not found.\n     */\n\n    if (!items || items.length <= 0) {\n      dispatch(updateNoMatch(true));\n      return;\n    }\n\n    const [product] = items;\n    const product_links = items.reduce(function (links, product) {\n      const {\n        product_links\n      } = product;\n\n      if (product_links) {\n        Object.values(product_links).forEach(function (item) {\n          links.push(item);\n        });\n      }\n\n      return links;\n    }, []);\n    LinkedProductsDispatcher.then(function ({\n      default: dispatcher\n    }) {\n      if (product_links.length > 0) {\n        dispatcher.handleData(dispatch, product_links);\n      } else {\n        dispatcher.clearLinkedProducts(dispatch);\n      }\n    });\n    dispatch(updateProductDetails(product));\n  }\n\n  onError(_, dispatch) {\n    dispatch(updateNoMatch(true));\n  }\n\n  prepareRequest(options) {\n    return ProductListQuery.getQuery(options);\n  }\n\n}, \"Store/Product/Dispatcher\");\nexport default new ProductDispatcher();","map":{"version":3,"sources":["/home/arturs/scandiweb/extension/node_modules/@scandipwa/scandipwa/src/store/Product/Product.dispatcher.js"],"names":["ProductListQuery","updateNoMatch","updateProductDetails","QueryDispatcher","LinkedProductsDispatcher","__construct","onSuccess","data","dispatch","products","items","length","product","product_links","reduce","links","Object","values","forEach","item","push","then","default","dispatcher","handleData","clearLinkedProducts","onError","_","prepareRequest","options","getQuery","ProductDispatcher"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,OAAOA,gBAAP;AACA,SAASC,aAAT;AACA,SAASC,oBAAT;AACA,SAASC,eAAT;AAEA,OAAO,MAAMC,wBAAwB,GAAG;AACpC;AADoC,sFAAjC;AAKP;AACA;AACA;AACA;AACA;AACA;;AACA,sGAAuCD,eAAvC,EAAuD;AACnDE,EAAAA,WAAW,GAAG;AACV,UAAMA,WAAN,CAAkB,SAAlB;AACH;;AAEDC,EAAAA,SAAS,CAACC,IAAD,EAAOC,QAAP,EAAiB;AACtB,UAAM;AAAEC,MAAAA,QAAQ,EAAE;AAAEC,QAAAA;AAAF;AAAZ,QAA0BH,IAAhC;AAEA;AACR;AACA;AACA;;AACQ,QAAI,CAACG,KAAD,IAAUA,KAAK,CAACC,MAAN,IAAgB,CAA9B,EAAiC;AAC7BH,MAAAA,QAAQ,CAACP,aAAa,CAAC,IAAD,CAAd,CAAR;AACA;AACH;;AAED,UAAM,CAACW,OAAD,IAAYF,KAAlB;AAEA,UAAMG,aAAa,GAAGH,KAAK,CAACI,MAAN,CAAa,UAACC,KAAD,EAAQH,OAAR,EAAoB;AACnD,YAAM;AAAEC,QAAAA;AAAF,UAAoBD,OAA1B;;AAEA,UAAIC,aAAJ,EAAmB;AACfG,QAAAA,MAAM,CAACC,MAAP,CAAcJ,aAAd,EAA6BK,OAA7B,CAAqC,UAACC,IAAD,EAAU;AAC3CJ,UAAAA,KAAK,CAACK,IAAN,CAAWD,IAAX;AACH,SAFD;AAGH;;AAED,aAAOJ,KAAP;AACH,KAVqB,EAUnB,EAVmB,CAAtB;AAYAX,IAAAA,wBAAwB,CAACiB,IAAzB,CACI,UAAC;AAAEC,MAAAA,OAAO,EAAEC;AAAX,KAAD,EAA6B;AACzB,UAAIV,aAAa,CAACF,MAAd,GAAuB,CAA3B,EAA8B;AAC1BY,QAAAA,UAAU,CAACC,UAAX,CAAsBhB,QAAtB,EAAgCK,aAAhC;AACH,OAFD,MAEO;AACHU,QAAAA,UAAU,CAACE,mBAAX,CAA+BjB,QAA/B;AACH;AACJ,KAPL;AAUAA,IAAAA,QAAQ,CAACN,oBAAoB,CAACU,OAAD,CAArB,CAAR;AACH;;AAEDc,EAAAA,OAAO,CAACC,CAAD,EAAInB,QAAJ,EAAc;AACjBA,IAAAA,QAAQ,CAACP,aAAa,CAAC,IAAD,CAAd,CAAR;AACH;;AAED2B,EAAAA,cAAc,CAACC,OAAD,EAAU;AACpB,WAAO7B,gBAAgB,CAAC8B,QAAjB,CAA0BD,OAA1B,CAAP;AACH;;AAlDkD,CAAvD;AAqDA,eAAe,IAAIE,iBAAJ,EAAf","sourcesContent":["/**\n * ScandiPWA - Progressive Web App for Magento\n *\n * Copyright © Scandiweb, Inc. All rights reserved.\n * See LICENSE for license details.\n *\n * @license OSL-3.0 (Open Software License (\"OSL\") v. 3.0)\n * @package scandipwa/base-theme\n * @link https://github.com/scandipwa/base-theme\n */\n\nimport ProductListQuery from 'Query/ProductList.query';\nimport { updateNoMatch } from 'Store/NoMatch/NoMatch.action';\nimport { updateProductDetails } from 'Store/Product/Product.action';\nimport { QueryDispatcher } from 'Util/Request';\n\nexport const LinkedProductsDispatcher = import(\n    /* webpackMode: \"lazy\", webpackChunkName: \"dispatchers\" */\n    'Store/LinkedProducts/LinkedProducts.dispatcher'\n);\n\n/**\n * Product List Dispatcher\n * @class ProductDispatcher\n * @extends ProductDispatcher\n * @namespace Store/Product/Dispatcher\n */\nexport class ProductDispatcher extends QueryDispatcher {\n    __construct() {\n        super.__construct('Product');\n    }\n\n    onSuccess(data, dispatch) {\n        const { products: { items } } = data;\n\n        /**\n         * In case there are no items, or item count is\n         * smaller then 0 => the product was not found.\n         */\n        if (!items || items.length <= 0) {\n            dispatch(updateNoMatch(true));\n            return;\n        }\n\n        const [product] = items;\n\n        const product_links = items.reduce((links, product) => {\n            const { product_links } = product;\n\n            if (product_links) {\n                Object.values(product_links).forEach((item) => {\n                    links.push(item);\n                });\n            }\n\n            return links;\n        }, []);\n\n        LinkedProductsDispatcher.then(\n            ({ default: dispatcher }) => {\n                if (product_links.length > 0) {\n                    dispatcher.handleData(dispatch, product_links);\n                } else {\n                    dispatcher.clearLinkedProducts(dispatch);\n                }\n            }\n        );\n\n        dispatch(updateProductDetails(product));\n    }\n\n    onError(_, dispatch) {\n        dispatch(updateNoMatch(true));\n    }\n\n    prepareRequest(options) {\n        return ProductListQuery.getQuery(options);\n    }\n}\n\nexport default new ProductDispatcher();\n"]},"metadata":{},"sourceType":"module"}